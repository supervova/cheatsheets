<!DOCTYPE html>
<html lang="ru" prefix="og: http://ogp.me/ns#"><head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>JavaScript. Практическое пособие</title>
<meta name="description" content="Интерфейсы: редактирование, общее {%- include details.html title=&quot;Защита от ошибок&quot; path=&quot;_how-to/general/error-handling.md&quot; id=&quot;topic-error-handling&quot; -%} {%- include details.html title=&quot;Пользовательское контекстное меню на ПКМ&quot; path=&quot;_how-to/general/custom-context-menu-at-clicked-position.md&quot; id=&quot;topic-context-menu&quot; -%} {%- include details.html title=&quot;Полный экран&quot; path=&quot;_how-to/general/full-screen.md&quot; id=&quot;topic-full-screen&quot; -%} {%- include details.html title=&quot;Вывод элемента в область видимости прокручиваемого контейнера&quot; path=&quot;_how-to/general/scroll-to-be-visible.md&quot; -%} {%- include details.html title=&quot;Пользовательская полоса прокрутки&quot; path=&quot;_how-to/general/custom-scrollbar.md&quot;...">
<meta name="author" content="Vladimir Nikishin, www.super-mark.ru">
<meta name="apple-mobile-web-app-title" content="Шпоры">
<meta name="theme-color" content="#e5effa"><link rel="canonical" href="https://cheatsheets.super-mark.ru/js/how-to"><link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Fira+Code&family=Roboto:wght@400;500&display=swap">

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlightjs-themes@1.0.0/mono-blue.css">
<link rel="stylesheet" href="/assets/css/style.css?20221103-0742">
</head>
<body>
    <main class="main">
  <h1>JavaScript. Практическое пособие</h1>
  <input class="input__field is-lg" id="topic-filter" type="text" placeholder="Фильтр записей: введите запрос">

  <section>
  <h2>Интерфейсы: редактирование, общее</h2><details class="accordion" id="topic-error-handling">
  <summary class="accordion__header">
    Защита от ошибок
  </summary>
  <div class="accordion__body">
      <h4 id="cannot-read-properties-of-undefined----------">“Cannot read Properties of Undefined” — в случае, когда объект или его поле не создано</h4>

      <p>Современный способ — с помощью <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Operators/Optional_chaining" target="_blank">оператора опциональной последовательности</a>.</p>

      <p>В примере если элемент <code class="language-plaintext highlighter-rouge">.potter</code> создан, вызываем его метод. Если такого элемента нет, ничего не произойдёт.</p>

      <p>А если <code class="language-plaintext highlighter-rouge">harry</code> не является свойством объекта <code class="language-plaintext highlighter-rouge">wizards</code> или не имеет поля <code class="language-plaintext highlighter-rouge">house</code>, ничего не произойдет. Если же нужные свойства будут найдены, то <code class="language-plaintext highlighter-rouge">house</code> будет переведён в нижний регистр.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.potter</span><span class="dl">'</span><span class="p">)?.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">meh</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">wizards</span> <span class="o">=</span> <span class="p">{};</span>
<span class="nx">wizards</span><span class="p">.</span><span class="nx">harry</span><span class="p">?.</span><span class="nx">house</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
</code></pre></div>      </div>

      <p>Оператор <code class="language-plaintext highlighter-rouge">?.</code> можно также использовать совместно с <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Operators/Nullish_coalescing_operator" target="_blank">оператором нулевого слияния</a> — <code class="language-plaintext highlighter-rouge">??</code> — для добавления запасного кода, на случай отсутствия нужного объекта или поля.</p>

      <p>В пример если <code class="language-plaintext highlighter-rouge">harry</code> не является свойством объекта <code class="language-plaintext highlighter-rouge">wizards</code> или не имеет поля <code class="language-plaintext highlighter-rouge">house</code>, то Гарри определяем в Пуффендуй (англ. Hufflepuff).</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">house</span> <span class="o">=</span>
<span class="err">  </span><span class="nx">wizards</span><span class="p">.</span><span class="nx">harry</span><span class="p">?.</span><span class="nx">house</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">()</span> <span class="p">??</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">hufflepuff</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div>      </div>

      <p>Проверка по-старинке.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">harry</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.potter</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">wizards</span> <span class="o">=</span> <span class="p">{};</span>

<span class="cm">/* Если элемент `.potter` создан, вызываем его
метод */</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">harry</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">harry</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">meh</span><span class="dl">'</span><span class="p">);</span>
<span class="p">}</span>

<span class="cm">/* Если свойство wizards.harry.house существует,
переводим его в нижний регистр */</span>
<span class="k">if</span> <span class="p">(</span><span class="nx">wizards</span><span class="p">.</span><span class="nx">harry</span> <span class="o">&amp;&amp;</span> <span class="nx">wizards</span><span class="p">.</span><span class="nx">harry</span><span class="p">.</span><span class="nx">house</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">wizards</span><span class="p">.</span><span class="nx">harry</span><span class="p">.</span><span class="nx">house</span><span class="p">.</span><span class="nx">toLowerCase</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p><a href="https://gomakethings.com/optional-chaining-in-vanilla-js/">Источник</a>. См. также: <a href="https://developer.mozilla.org/ru/docs/Web/JavaScript/Reference/Errors" target="_blank">список ошибок</a></p>
    </div>
</details>
<details class="accordion" id="topic-context-menu">
  <summary class="accordion__header">
    Пользовательское контекстное меню на ПКМ
  </summary>
  <div class="accordion__body">
      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"is-relative"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"element"</span><span class="nt">&gt;</span>
    Кликни правой кнопкой мыши (ПКМ)
  <span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;ul</span> <span class="na">class=</span><span class="s">"menu is-context"</span> <span class="na">role=</span><span class="s">"menu"</span> <span class="na">id=</span><span class="s">"menu"</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/ul&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <h4 id="section">Предотвращаем вызов стандартного контекстного меню</h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">element</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">contextmenu</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-1">Показываем пользовательское меню в области клика</h4>

      <p>Чтобы получить координаты меню, оно должно быть абсолютно позиционировано относительно своего контейнера. Поэтому в разметке добавлена «обёртка» <code class="language-plaintext highlighter-rouge">.is-relative</code>.</p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.is-relative</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.menu.is-context</span> <span class="p">{</span>
<span class="err">  //</span> <span class="err">Скрыто</span> <span class="err">по</span> <span class="err">умолчанию</span>
<span class="err">  </span><span class="nl">display</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>

<span class="err">  &amp;.is-on</span> <span class="err">{</span>
<span class="err">    </span><span class="nl">display</span><span class="p">:</span> <span class="nb">block</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="err">}</span>
</code></pre></div>      </div>

      <p>Рассчитываем позицию меню по позиции мышки.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">contextmenu</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Задаем координаты</span>
<span class="err">  </span><span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">y</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">menu</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">x</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Показываем меню</span>
<span class="err">  </span><span class="nx">menu</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">is-on</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-2">Закрываем меню по клику за его пределами</h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">contextmenu</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="cm">/* ...
  Добавляем вложенный слушатель */</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">docClickHandler</span><span class="p">);</span>
<span class="p">});</span>

<span class="cm">/** Прячем меню на клике за его пределами */</span>
<span class="kd">const</span> <span class="nx">docClickHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">isClickedOutside</span> <span class="o">=</span> <span class="o">!</span><span class="nx">menu</span><span class="p">.</span><span class="nx">contains</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">isClickedOutside</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">menu</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">is-on</span><span class="dl">'</span><span class="p">);</span>

<span class="err">    </span><span class="c1">// Удаляем обработчик</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">docClickHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Обработчик клика удаляется со страницы вместе с меню, так как он не нужен, пока меню скрыто.</p>
    </div>
</details>
<details class="accordion" id="topic-full-screen">
  <summary class="accordion__header">
    Полный экран
  </summary>
  <div class="accordion__body">
      <p>Для выхода в полноэкранный режим используется Fullscreen API, интерфейсы веб API и метод <code class="language-plaintext highlighter-rouge">requestFullscreen()</code>, который он добавляет объектам <code class="language-plaintext highlighter-rouge">Document</code> и <code class="language-plaintext highlighter-rouge">Element</code>.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;article&gt;</span>
  <span class="nt">&lt;h1&gt;</span>Hello World<span class="nt">&lt;/h1&gt;</span>
<span class="nt">&lt;/article&gt;</span>
<span class="nt">&lt;button&gt;</span>Say it louder<span class="nt">&lt;/button&gt;</span>
</code></pre></div>      </div>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">greetings</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">article</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">button</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">button</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">takeFullscreen</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">greetings</span><span class="p">.</span><span class="nx">requestFullscreen</span><span class="p">();</span>
<span class="p">};</span>

<span class="nx">button</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">takeFullscreen</span><span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Вывод элемента в область видимости прокручиваемого контейнера
  </summary>
  <div class="accordion__body">
      <p>Функция <code class="language-plaintext highlighter-rouge">scrollToBeVisible</code> перемещает элемент, переданный в первый параметр, в область видимости контейнера, переданного во второй параметр. См. также раздел <a href="/#topic-is-visible">«Виден ли элемент в области просмотра блока с прокруткой»</a></p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">scrollToBeVisible</span> <span class="o">=</span> <span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="nx">container</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">eleTop</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">offsetTop</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">eleBottom</span> <span class="o">=</span> <span class="nx">eleTop</span> <span class="o">+</span> <span class="nx">el</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">containerTop</span> <span class="o">=</span> <span class="nx">container</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">containerBottom</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">containerTop</span> <span class="o">+</span> <span class="nx">container</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">;</span>

<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">eleTop</span> <span class="o">&lt;</span> <span class="nx">containerTop</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Прокрутка вверх контейнера</span>
<span class="err">    </span><span class="nx">container</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">-=</span> <span class="nx">containerTop</span> <span class="o">-</span> <span class="nx">eleTop</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="nx">eleBottom</span> <span class="o">&gt;</span> <span class="nx">containerBottom</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Прокрутка вниз контейнера</span>
<span class="err">    </span><span class="nx">container</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">+=</span> <span class="nx">eleBottom</span> <span class="o">-</span> <span class="nx">containerBottom</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Пользовательская полоса прокрутки
  </summary>
  <div class="accordion__body">
      <p>Можно обновить внешний вид полосы прокрутки исключительно стилями.</p>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Firefox</span>
<span class="nt">body</span> <span class="p">{</span>
<span class="err">  </span><span class="na">scrollbar-width</span><span class="p">:</span> <span class="nb">thin</span><span class="p">;</span>
<span class="err">  
  // Цвета бегунка и «рельса»
  </span><span class="na">scrollbar-color</span><span class="p">:</span> <span class="mh">#718096</span> <span class="mh">#edf2f7</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Chrome, Edge и Safari</span>
<span class="na">body</span><span class="p">:</span><span class="o">:-</span><span class="n">webkit-scrollbar</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">width</span><span class="p">:</span> <span class="mi">.75rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">*</span><span class="p">:</span><span class="o">:-</span><span class="n">webkit-scrollbar-track</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">background-color</span><span class="p">:</span> <span class="mh">#edf2f7</span><span class="p">;</span>
<span class="p">}</span>

<span class="err">*</span><span class="p">:</span><span class="o">:-</span><span class="n">webkit-scrollbar-thumb</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">background-color</span><span class="p">:</span> <span class="mh">#718096</span><span class="p">;</span>
<span class="err">  </span><span class="nl">border-radius</span><span class="p">:</span> <span class="m">9999px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <h4 id="section-3">Альтернативный метод</h4>

      <p>Но поскольку <code class="language-plaintext highlighter-rouge">-webkit-scrollbar</code> не является стандартным псевдоэлементом и однажды может перестать поддерживаться, можно скрыть родной скроллбар браузера и вместо него использовать пользовательский. Например, для такого контейнера с прокруткой.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"wrapper"</span> <span class="na">id=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"content"</span> <span class="na">id=</span><span class="s">"content"</span><span class="nt">&gt;</span>
    ...
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.wrapper</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
<span class="err">  </span><span class="nl">max-height</span><span class="p">:</span> <span class="m">32rem</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.content</span> <span class="p">{</span>
<span class="c1">// Скрыть скроллбар по умолчанию</span>
<span class="nl">margin-right</span><span class="p">:</span> <span class="m">-1</span><span class="mi">.6rem</span><span class="p">;</span>
<span class="nl">padding-right</span><span class="p">:</span> <span class="m">1</span><span class="mi">.6rem</span><span class="p">;</span>

<span class="err">  </span><span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <h4 id="section-4">Пользовательская полоса прокрутки — исходная разметка и логика</h4>

      <p>Добавим под «обёрткой» добавим «якорь» — ориентир для позиционирования скроллбара — и собственно скроллбар.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"wrapper"</span><span class="nt">&gt;</span>...<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- Якорь --&gt;</span>
<span class="nt">&lt;div</span>
<span class="err">  </span><span class="na">id=</span><span class="s">"anchor"</span>
<span class="err">  </span><span class="na">style=</span><span class="s">"position: absolute; top: 0; left: 0;"</span>
<span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- Скроллбар --&gt;</span>
<span class="nt">&lt;div</span>
<span class="err">  </span><span class="na">id=</span><span class="s">"scrollbar"</span>
<span class="err">  </span><span class="na">style=</span><span class="s">"position: absolute; width: .75rem;"</span>
<span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Установим скроллбар в правый верхний угол.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">wrapper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">wrapper</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">content</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">content</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">anchor</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">anchor</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">scrollbar</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">scrollbar</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Получаем размеры и положения контейнера и якоря</span>
<span class="kd">const</span> <span class="nx">wrapperRect</span> <span class="o">=</span> <span class="nx">wrapper</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="kd">const</span> <span class="nx">anchorRect</span> <span class="o">=</span> <span class="nx">anchor</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="c1">// Устанавливаем скроллбар</span>
<span class="kd">const</span> <span class="nx">top</span> <span class="o">=</span> <span class="nx">wrapperRect</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">anchorRect</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">left</span> <span class="o">=</span> <span class="nx">wrapperRect</span><span class="p">.</span><span class="nx">width</span> <span class="o">+</span> <span class="nx">wrapperRect</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">anchorRect</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
<span class="nx">scrollbar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">top</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="nx">scrollbar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">left</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="c1">// Высота скроллбара равна высоте контейнера</span>
<span class="nx">scrollbar</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">wrapperRect</span><span class="p">.</span><span class="nx">height</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
</code></pre></div>      </div>

      <h4 id="section-5">Конструируем полосу прокрутки</h4>

      <p>Скроллбар состоит из «рельса» <code class="language-plaintext highlighter-rouge">track</code> и бегунка <code class="language-plaintext highlighter-rouge">thumb</code> — абсолютно позиционированных относительно родительского элемента.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"scrollbar"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"track"</span> <span class="na">id=</span><span class="s">"track"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"thumb"</span> <span class="na">id=</span><span class="s">"thumb"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.track</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
<span class="err">  </span><span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>

<span class="err">  // Растягиваем на всю площадь
  </span><span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.thumb</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
<span class="err">  
  // Растягиваем только по ширине
  </span><span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>Рассчитываем высоту бегунка: пропорционально отношению высоты содержания и высоты контейнера.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">track</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">track</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">thumb</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">thumb</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">scrollRatio</span> <span class="o">=</span>
<span class="err">  </span><span class="nx">content</span><span class="p">.</span><span class="nx">clientHeight</span> <span class="o">/</span> <span class="nx">content</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="nx">thumb</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">scrollRatio</span> <span class="o">*</span> <span class="mi">100</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
</code></pre></div>      </div>

      <h4 id="section-6">Перетаскивание для прокрутки</h4>

      <p>Подробнее о технике <a href="#topic-drag-to-scroll">см. здесь</a>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span> <span class="na">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseDownThumbHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Текущая позиция бегунка прокрутки</span>
<span class="err">    </span><span class="na">top</span><span class="p">:</span> <span class="nx">content</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">,</span>
<span class="err">    </span><span class="c1">// Текущая позиция курсора</span>
<span class="err">    </span><span class="na">y</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко курсор переместился</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Прокручиваем содержание</span>
<span class="err">  </span><span class="nx">content</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">dy</span> <span class="o">/</span> <span class="nx">scrollRatio</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Назначаем обработчик `mousedown`</span>
<span class="nx">thumb</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownThumbHandler</span>
<span class="p">);</span>
</code></pre></div>      </div>

      <p>Когда пользователь перетягивает бегунок, он также прокручивает содержание элемента <code class="language-plaintext highlighter-rouge">content</code>. Для того, чтобы обновлять положение бегунка назначим обработчик события <code class="language-plaintext highlighter-rouge">scroll</code> на элемент <code class="language-plaintext highlighter-rouge">content</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">scrollContentHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">thumb</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`
      </span><span class="p">${(</span><span class="nx">content</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
<span class="err">      </span><span class="nx">content</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">}</span><span class="s2">%
    `</span><span class="p">;</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">};</span>

<span class="nx">content</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">scroll</span><span class="dl">'</span><span class="p">,</span> <span class="nx">scrollContentHandler</span><span class="p">);</span>
</code></pre></div>      </div>

      <h4 id="section-7">Переходы по клику на «рельсе»</h4>

      <p>Для этого способа прокрутки мы должны снова рассчитать свойство <code class="language-plaintext highlighter-rouge">scrollTop</code> элемента <code class="language-plaintext highlighter-rouge">content</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">trackClickHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">bound</span> <span class="o">=</span> <span class="nx">track</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">percentage</span> <span class="o">=</span>
<span class="err">    </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">top</span><span class="p">)</span> <span class="o">/</span> <span class="nx">bound</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
<span class="err">  </span><span class="nx">content</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">percentage</span> <span class="o">*</span>
<span class="err">    </span><span class="p">(</span><span class="nx">content</span><span class="p">.</span><span class="nx">scrollHeight</span> <span class="o">-</span> <span class="nx">content</span><span class="p">.</span><span class="nx">clientHeight</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">track</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">trackClickHandler</span><span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion" id="topic-range">
  <summary class="accordion__header">
    Слайдер диапазона — `range`
  </summary>
  <div class="accordion__body">
      <p>Два способа создать элемент управления.</p>

      <h4 id="inputtyperange--css">1) <code class="language-plaintext highlighter-rouge">input[type='range']</code> и CSS</h4>

      <p>«Дешево и сердито».</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"range"</span><span class="nt">&gt;</span>
</code></pre></div>      </div>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">[</span><span class="nt">type</span><span class="o">=</span><span class="s1">'range'</span><span class="o">]</span> <span class="p">{</span>
<span class="err">  </span><span class="na">--thumb-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">color-primary-base</span><span class="p">);</span>
<span class="err">  </span><span class="na">--border-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">color-ink-border</span><span class="p">);</span>

<span class="err">  $</span><span class="na">size-height-range-track</span><span class="p">:</span> <span class="nv">$size-half</span><span class="p">;</span>
<span class="err">  $</span><span class="na">size-height-range-thumb</span><span class="p">:</span> <span class="nv">$size-2p5</span><span class="p">;</span>
<span class="err">  $</span><span class="na">size-border-width-range-thumb</span><span class="p">:</span> <span class="nv">$size-half</span><span class="p">;</span>

<span class="err">  </span><span class="nl">appearance</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err">  </span><span class="nl">background</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="nv">$size-height-range-thumb</span><span class="p">;</span>
<span class="err">  </span><span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>

<span class="err">  </span><span class="o">//</span> <span class="err">⚠️</span> <span class="err">Список</span> <span class="err">селекторов</span> <span class="err">в</span> <span class="err">случае</span>
<span class="err">  </span><span class="o">//</span> <span class="err">с</span> <span class="err">нестандартными</span> <span class="err">псведоэлементами</span>
<span class="err">  </span><span class="o">//</span> <span class="err">не</span> <span class="err">срабатывает</span><span class="nc">.</span> <span class="err">Только</span> <span class="err">миксин</span> <span class="err">и</span> <span class="err">инклуд</span>
<span class="err">  </span><span class="o">//</span> <span class="err">для</span> <span class="err">каждого</span> <span class="err">селектора</span> <span class="err">по</span> <span class="err">отдельности</span>
<span class="err">  </span><span class="o">@</span><span class="nt">mixin</span> <span class="nt">range-track</span> <span class="p">{</span>
<span class="err">    </span><span class="nl">background-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">border-color</span><span class="p">);</span>
<span class="err">    </span><span class="nl">border-radius</span><span class="p">:</span> <span class="nv">$shape-border-radius-pill</span><span class="p">;</span>
<span class="err">    </span><span class="nl">transition</span><span class="p">:</span>
<span class="err">      </span><span class="n">background</span>
<span class="err">      </span><span class="nv">$motion-duration-sm</span>
<span class="err">      </span><span class="nv">$motion-easing-base</span><span class="o">,</span>
<span class="err">      </span><span class="n">box-shadow</span>
<span class="err">      </span><span class="nv">$motion-duration-sm</span>
<span class="err">      </span><span class="nv">$motion-easing-base</span><span class="p">;</span>
<span class="err">    </span><span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err">    </span><span class="nl">height</span><span class="p">:</span> <span class="nv">$size-height-range-track</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  // </span><span class="na">Track</span><span class="err">
  &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">webkit-slider-runnable-track</span> <span class="p">{</span>
<span class="err">    </span><span class="o">@</span><span class="nt">include</span> <span class="nt">range-track</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">moz-range-track</span> <span class="p">{</span>
<span class="err">    </span><span class="o">@</span><span class="nt">include</span> <span class="nt">range-track</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">ms-track</span> <span class="p">{</span>
<span class="err">    </span><span class="o">@</span><span class="nt">include</span> <span class="nt">range-track</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="o">@</span><span class="nt">mixin</span> <span class="nt">range-thumb</span> <span class="p">{</span>
<span class="err">    </span><span class="nl">appearance</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err">    </span><span class="nl">background-color</span><span class="p">:</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">thumb-color</span><span class="p">);</span>
<span class="err">    </span><span class="nl">border-radius</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
<span class="err">    </span><span class="nl">border</span><span class="p">:</span>
<span class="err">      </span><span class="nv">$size-border-width-range-thumb</span>
<span class="err">      </span><span class="nb">solid</span>
<span class="err">      </span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">range-thumb-border-color</span><span class="p">);</span>
<span class="err">    </span><span class="nl">cursor</span><span class="p">:</span> <span class="nb">pointer</span><span class="p">;</span>
<span class="err">    </span><span class="nl">margin-top</span><span class="p">:</span> <span class="nf">-</span><span class="p">(</span>
<span class="err">      </span><span class="nv">$size-height-range-thumb</span> <span class="o">*</span> <span class="mi">.5</span> <span class="o">-</span>
<span class="err">      </span><span class="nv">$size-height-range-track</span> <span class="o">*</span> <span class="mi">.5</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nl">transition</span><span class="p">:</span>
<span class="err">      </span><span class="n">background</span>
<span class="err">      </span><span class="nv">$motion-duration-sm</span>
<span class="err">      </span><span class="nv">$motion-easing-base</span><span class="o">,</span>
<span class="err">      </span><span class="n">transform</span>
<span class="err">      </span><span class="nv">$motion-duration-sm</span>
<span class="err">      </span><span class="nv">$motion-easing-base</span><span class="p">;</span>
<span class="err">    </span><span class="nl">width</span><span class="p">:</span> <span class="nv">$size-height-range-thumb</span><span class="p">;</span>
<span class="err">    </span><span class="nl">height</span><span class="p">:</span> <span class="nv">$size-height-range-thumb</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  // </span><span class="na">Thumb</span><span class="err">
  &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">webkit-slider-thumb</span> <span class="p">{</span>
<span class="err">    </span><span class="o">@</span><span class="nt">include</span> <span class="nt">range-thumb</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">moz-range-thumb</span> <span class="p">{</span>
<span class="err">    </span><span class="o">@</span><span class="nt">include</span> <span class="nt">range-thumb</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">ms-thumb</span> <span class="p">{</span>
<span class="err">    </span><span class="o">@</span><span class="nt">include</span> <span class="nt">range-thumb</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="k">&amp;</span><span class="nd">:hover</span> <span class="p">{</span>
<span class="err">    </span><span class="na">--thumb-color</span><span class="p">:</span> <span class="nf">hsl</span><span class="p">(</span><span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">h</span><span class="p">)</span> <span class="nf">var</span><span class="p">(</span><span class="o">--</span><span class="n">s</span><span class="p">)</span> <span class="m">65%</span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="k">&amp;</span><span class="nd">:hover</span><span class="o">,</span>
<span class="err">  </span><span class="k">&amp;</span><span class="nd">:focus</span><span class="o">,</span>
<span class="err">  </span><span class="k">&amp;</span><span class="nd">:active</span> <span class="p">{</span>
<span class="err">    // </span><span class="na">Thumb</span><span class="err">
    &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">webkit-slider-thumb</span> <span class="p">{</span>
<span class="err">      </span><span class="nl">transform</span><span class="p">:</span> <span class="nf">scale</span><span class="p">(</span><span class="m">1</span><span class="mi">.25</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">moz-range-thumb</span> <span class="p">{</span>
<span class="err">      </span><span class="nl">transform</span><span class="p">:</span> <span class="nf">scale</span><span class="p">(</span><span class="m">1</span><span class="mi">.25</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    &amp;</span><span class="p">:</span><span class="o">:-</span><span class="n">ms-thumb</span> <span class="p">{</span>
<span class="err">      </span><span class="nl">transform</span><span class="p">:</span> <span class="nf">scale</span><span class="p">(</span><span class="m">1</span><span class="mi">.25</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p><code class="language-plaintext highlighter-rouge">input[type='range']</code> поддерживается абсолютным абсолютным большинством браузеров. Но, если потребуется, можно добавить проверку.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">isRangeInputSupported</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">range</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="cm">/* Если браузер не поддерживает поле `range`,
  атрибуту `type` будет присвоено значение `text` */</span>
<span class="err">  </span><span class="k">return</span> <span class="nx">el</span><span class="p">.</span><span class="nx">type</span> <span class="o">!==</span> <span class="dl">'</span><span class="s1">text</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Минус метода — нельзя сделать вертикальный виджет.</p>

      <h4 id="js">2) JS</h4>

      <p>Пользовательский слайдер диапазона собирается из трех деталей: бегунка и двух половинок дорожки.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"left"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"thumb"</span> <span class="na">id=</span><span class="s">"thumb"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"right"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
<span class="err">  </span><span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="nv">$size-2p5</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.right</span> <span class="p">{</span>
<span class="err">  // Правая половинка занимает
  // всё свободное место
  </span><span class="nl">flex</span><span class="p">:</span> <span class="m">1</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="nv">$size-half</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>Назначим на бегунок обработчик события <code class="language-plaintext highlighter-rouge">mousedown</code>, чтобы сделать его перетаскиваемым. В обработчик будет сохранятся позиция элемента.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">thumb</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">thumb</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">leftSide</span> <span class="o">=</span> <span class="nx">thumb</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>

<span class="c1">// The current position of mouse</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">leftWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Обработчик будет срабатывать при перетаскивании</span>
<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Текущая позиция мыши</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
<span class="err">  </span><span class="nx">leftWidth</span> <span class="o">=</span> <span class="nx">leftSide</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Назначаем вложенные обработчики</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>

<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Когда бегунок перемещаемся, мы можем рассчитать расстояние, которое проделал курсор — это будет разница между исходной и текущей позицией. С этими данными мы можем рассчитать и ширину левой части дорожки.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко мышь продвинулась</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">containerWidth</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">thumb</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">newLeftWidth</span> <span class="o">=</span>
<span class="err">    </span><span class="p">((</span><span class="nx">leftWidth</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="nx">containerWidth</span><span class="p">;</span>
<span class="err">  </span><span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newLeftWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="err">  </span><span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">newLeftWidth</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">newLeftWidth</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Обработчик срабатывает в тот момент,
когда пользователь отпускает бегунок */</span>
<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">user-select</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">pointer-events</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="nx">rightSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">user-select</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">rightSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">pointer-events</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Удаляем слушатели, пока они не нужны</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span>
<span class="err">    </span><span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span>
<span class="err">    </span><span class="nx">mouseUpHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Назначаем обработчик</span>
<span class="nx">thumb</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span>
<span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Плавная прокрутка — пользовательская настройка анимации
  </summary>
  <div class="accordion__body">
      <p>Плавную прокрутку легко можно сделать в JS…</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">el</span><span class="p">.</span><span class="nx">scrollIntoView</span><span class="p">({</span> <span class="na">behavior</span><span class="p">:</span> <span class="dl">'</span><span class="s1">smooth</span><span class="dl">'</span> <span class="p">});</span>
</code></pre></div>      </div>

      <p>… Или CSS.</p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">scroll-behavior</span><span class="o">:</span> <span class="nt">smooth</span><span class="o">;</span>
</code></pre></div>      </div>

      <p>Но оба метода не дают разработчику изменить анимацию прокрутки.</p>

      <p>В этом разделе разбираем сложный, но дающий большую свободу метод.</p>

      <p>Разметка:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"trigger"</span> <span class="na">href=</span><span class="s">"#section-1"</span><span class="nt">&gt;&lt;/a&gt;</span>
<span class="nt">&lt;a</span> <span class="na">class=</span><span class="s">"trigger"</span> <span class="na">href=</span><span class="s">"#section-2"</span><span class="nt">&gt;&lt;/a&gt;</span>
...

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"section-1"</span><span class="nt">&gt;</span>...<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"section-2"</span><span class="nt">&gt;</span>...<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>После клика по ссылка страница должны прокрутиться к соответствующему разделу.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">triggers</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">.trigger</span><span class="dl">'</span>
<span class="p">);</span>

<span class="nx">triggers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">clickHandler</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p><code class="language-plaintext highlighter-rouge">clickHandler</code> обрабатывает событие <code class="language-plaintext highlighter-rouge">click</code> по ссылке. Определяет целевой раздел страницы по атрибуту <code class="language-plaintext highlighter-rouge">href</code> и прокручивает страницу к нужному разделу:</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">clickHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

<span class="err">  </span><span class="c1">// Получаем id целевой секции из атрибута `href`</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">href</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">href</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">id</span> <span class="o">=</span> <span class="nx">href</span><span class="p">.</span><span class="nx">substr</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">target</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="nx">id</span><span class="p">);</span>

<span class="err">  </span><span class="nx">scrollToTarget</span><span class="p">(</span><span class="nx">target</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="scrolltotarget">Функция <code class="language-plaintext highlighter-rouge">scrollToTarget</code></h4>

      <p>Чтобы прокрутить страницу к нужному место можно использовать метод <code class="language-plaintext highlighter-rouge">window.scrollTo(0, y)</code> который прокручивает к месту по указанному расстоянию от верхнего края.</p>

      <ul>
        <li>Начальная точка прокрутки — текущее положение страницы в области просмотра — <code class="language-plaintext highlighter-rouge">window.pageYOffset</code>.</li>
        <li>Конечная точка — расстояние до целевого раздела. Значение можно получить с помощью <code class="language-plaintext highlighter-rouge">target.getBoundingClientRect().top</code>.</li>
        <li>Продолжительность прокрутки указывается в миллисекундах. В примере — 800 мс.</li>
      </ul>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">duration</span> <span class="o">=</span> <span class="mi">800</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">scrollToTarget</span> <span class="o">=</span> <span class="p">(</span><span class="nx">target</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="p">{</span> <span class="nx">top</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">target</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">startPos</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">pageYOffset</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">diff</span> <span class="o">=</span> <span class="nx">top</span><span class="p">;</span>

<span class="err">  </span><span class="kd">let</span> <span class="nx">startTime</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">requestId</span><span class="p">;</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">loop</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currentTime</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">startTime</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">startTime</span> <span class="o">=</span> <span class="nx">currentTime</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    </span><span class="c1">// Время в миллисекундах</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>

<span class="err">    </span><span class="kd">const</span> <span class="nx">percent</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">time</span> <span class="o">/</span> <span class="nx">duration</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="err">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">startPos</span> <span class="o">+</span> <span class="nx">diff</span> <span class="o">*</span> <span class="nx">percent</span><span class="p">);</span>

<span class="err">    </span><span class="k">if</span> <span class="p">(</span><span class="nx">time</span> <span class="o">&lt;</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// Продолжаем прокрутку</span>
<span class="err">      </span><span class="nx">requestId</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// Останавливаем</span>
<span class="err">      </span><span class="nb">window</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span><span class="p">(</span><span class="nx">requestId</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">};</span>
<span class="err">  </span><span class="nx">requestId</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Здесь мы указываем браузеру выполнить функцию <code class="language-plaintext highlighter-rouge">loop</code> до того, как появится целевой радел. При первом выполнении функции инициализируется переменная <code class="language-plaintext highlighter-rouge">starttime</code> — как текущая временная метка <code class="language-plaintext highlighter-rouge">currenttime</code>.</p>

      <p>Затем мы вычисляем время, затраченное к текущему моменту на прокрутку:</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">time</span> <span class="o">=</span> <span class="nx">currentTime</span> <span class="o">-</span> <span class="nx">startTime</span><span class="p">;</span>
</code></pre></div>      </div>

      <p>Зная затраченное время и заданную продолжительность, нетрудно рассчитать процент выполнения полного цикла прокрутки. И затем передать данные в метод <code class="language-plaintext highlighter-rouge">scrollTo</code> для расчета конечной координаты.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// `percent` — это диапазон от 0 до 1</span>
<span class="kd">const</span> <span class="nx">percent</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">time</span> <span class="o">/</span> <span class="nx">duration</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nx">startPos</span> <span class="o">+</span> <span class="nx">diff</span> <span class="o">*</span> <span class="nx">percent</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>Если затраченное время меньше заданной продолжительности, продолжаем прокрутку. В противном случае останавливаемся.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">if</span> <span class="p">(</span><span class="nx">time</span> <span class="o">&lt;</span> <span class="nx">duration</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">requestId</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">requestAnimationFrame</span><span class="p">(</span><span class="nx">loop</span><span class="p">);</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">cancelAnimationFrame</span><span class="p">(</span><span class="nx">requestId</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>☝️🧐 Часто для расчетов анимации используется <code class="language-plaintext highlighter-rouge">setTimeout()</code> или <code class="language-plaintext highlighter-rouge">setInterval()</code>, но использованный в примере<a href="https://developer.mozilla.org/ru/docs/Web/API/window/requestAnimationFrame" target="_blank">requestAnimationFrame</a> метод лучше по показателям производительности.</p>

      <h4 id="section-8">Настройка анимации</h4>

      <p>До сих пор анимация осуществлялась неестественно прямолинейно. Но мы можем добавить <a href="https://1loc.dev/misc/easing-functions/" target="_blank">любой эффект замедления</a>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">easeInQuad</span> <span class="o">=</span> <span class="p">(</span><span class="nx">t</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">return</span> <span class="nx">t</span> <span class="o">*</span> <span class="nx">t</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">loop</span> <span class="o">=</span> <span class="p">(</span><span class="nx">currentTime</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">percent</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">time</span> <span class="o">/</span> <span class="nx">duration</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
<span class="err">  </span><span class="nb">window</span><span class="p">.</span><span class="nx">scrollTo</span><span class="p">(</span>
<span class="err">    </span><span class="mi">0</span><span class="p">,</span> <span class="nx">startPos</span> <span class="o">+</span> <span class="nx">diff</span> <span class="o">*</span> <span class="nx">easeInQuad</span><span class="p">(</span><span class="nx">percent</span><span class="p">)</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/scroll-to-an-element-smoothly/index.htm" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion" id="topic-stateful-counter">
  <summary class="accordion__header">
    Пример stateful-компонента — счётчик
  </summary>
  <div class="accordion__body">
      <ol>
        <li>Начнём с создания состояния — объекта в глобальной области видимости (на практике, область видимости ограничивается). Единственным свойством объекта сделаем счетчик, с нулевым исходным значением.</li>
      </ol>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
<span class="err">  </span><span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <ol>
        <li>Создадим компонент — простую стрелочную функцию возвращающую шаблонный литерал.</li>
      </ol>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">return</span><span class="err">  </span><span class="s2">`&lt;div class="counter"&gt;</span><span class="p">${</span><span class="nx">count</span><span class="p">}</span><span class="s2">&lt;/div&gt;`</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <ol>
        <li>Создадим функцию рендеринга HTML, которая будет обновлять интерфейс после каждого обновления счетчика пользователем.</li>
      </ol>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">renderCount</span><span class="p">()</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">app</span><span class="dl">'</span><span class="p">)</span>
<span class="err">    </span><span class="cm">/* Передаём в контейнер разметку
    из функцию компонента */</span>
<span class="err">    </span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">counter</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <ol>
        <li>Сделаем метод обновления счётчика. Встроенного метода SetState в JavaScript нет, поэтому будем обновлять напрямую (в React это категорически не рекомендуется):</li>
      </ol>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">function</span> <span class="nx">incCountUp</span><span class="p">()</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">newCount</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="err">  </span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="nx">newCount</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <ol>
        <li>Установим слушатель на кнопку. Всякий раз, когда пользователь будет на неё кликать, будет обновляться значение <code class="language-plaintext highlighter-rouge">state.count</code>. Затем мы будем вызывать метод рендеринга для обновления HTML.</li>
      </ol>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">[data-action="count-up"]</span><span class="dl">'</span>
<span class="p">);</span>

<span class="nx">btn</span><span class="p">.</span><span class="nx">click</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">incCountUp</span><span class="p">();</span>
<span class="err">  </span><span class="nx">renderCount</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Полный код, с небольшими улучшениями — добавлением CSS-классов в зависимости от значения счётчика.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">display</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">display</span><span class="dl">'</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">btn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">[data-action="count-up"]</span><span class="dl">'</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">state</span> <span class="o">=</span> <span class="p">{</span>
<span class="err">  </span><span class="na">count</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span>
<span class="p">};</span>

<span class="c1">// Components</span>

<span class="kd">const</span> <span class="nx">counter</span> <span class="o">=</span> <span class="p">(</span><span class="nx">count</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">text-error</span><span class="dl">'</span><span class="p">;</span>

<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">count</span> <span class="o">&gt;</span> <span class="mi">10</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">className</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">text-success</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="k">return</span> <span class="s2">`
    &lt;p class="counter"&gt;
      Count:
      &lt;span class="</span><span class="p">${</span><span class="nx">className</span><span class="p">}</span><span class="s2">"&gt;
        </span><span class="p">${</span><span class="nx">count</span><span class="p">}</span><span class="s2">
      &lt;/span&gt;
    &lt;/p&gt;
  `</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Render Methods</span>

<span class="kd">function</span> <span class="nx">renderCount</span><span class="p">()</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">display</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">counter</span><span class="p">(</span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span><span class="p">);</span>
<span class="p">}</span>

<span class="c1">// Update methods</span>

<span class="kd">function</span> <span class="nx">incCountUp</span><span class="p">()</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">newCount</span> <span class="o">=</span> <span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="err">  </span><span class="nx">state</span><span class="p">.</span><span class="nx">count</span> <span class="o">=</span> <span class="nx">newCount</span><span class="p">;</span>

<span class="err">  </span><span class="nx">renderCount</span><span class="p">();</span>
<span class="p">}</span>

<span class="nx">renderCount</span><span class="p">();</span>

<span class="nx">btn</span><span class="p">.</span><span class="nx">click</span><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">incCountUp</span><span class="p">();</span>
<span class="err">  </span><span class="nx">renderCount</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p><a href="/js/advanced-theory.html#topic-classes-stateful-components">Подробнее о stateful-компонентах</a></p>
    </div>
</details>
</section>

<section>
  <h2>Анимация</h2><details class="accordion" id="topic-animation-height">
  <summary class="accordion__header">
    Анимация высоты: от 0 до `max-height`
  </summary>
  <div class="accordion__body">
      <p>Невозможно закодировать плавный переход от нулевой высоты к высоте содержания, используя только CSS. С помощью JS надо получить высоту содержания открытого контейнера и изменить значение переменной <code class="language-plaintext highlighter-rouge">--max-height</code>. Это можно сделать на клике или на <code class="language-plaintext highlighter-rouge">:hover</code>, как в примере.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"details"</span><span class="nt">&gt;</span>
  Hover me to see a height transition.
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"details__body"</span><span class="nt">&gt;</span>Additional content<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.details__body</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
<span class="err">  </span><span class="nl">transition</span><span class="p">:</span> <span class="n">max-height</span> <span class="m">.3s</span><span class="p">;</span>
<span class="err">  </span><span class="nl">max-height</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.details</span><span class="nd">:hover</span> <span class="o">&gt;</span> <span class="nc">.details__body</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">max-height</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--max-height</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">.details__body</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">setProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">--max-height</span><span class="dl">'</span><span class="p">,</span> <span class="nx">height</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">px</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
</section>

<section>
  <h2>Расчёты</h2><details class="accordion" id="topic-calculation-binary-search">
  <summary class="accordion__header">
    Бинарный поиск
  </summary>
  <div class="accordion__body">
      <p>Бинарный поиск — это алгоритм, который получает отсортированный список элементов и ищет заданный элемент, разделяя массив пополам, сравнивая элемент в середине с определенным условием и выполняя эту операцию до тех пор пока не будет найден искомый вариант.</p>

      <p>Если элемент, который  мы ищем, присутствует в списке, то функция бинарного поиска возвращает ту позицию, в которой он был найден. В противном слу­чае возвращает null.</p>

      <p>Например. Некто загадал число от 1 до 100. Мы должны отгадать. А загадавший при каждой попытке будет давать один из трех ответов: «мало», «много» или «угадал».</p>

      <p>Если мы начнем перебирать все варианты подряд — 1, 2, 3, 4… — то в случае, если было загадано 99, на поиск верного ответа уйдет 99 попыток.</p>

      <p>Существует другой, более эффективный способ.</p>

      <p>— Начнем с 50.<br />
— Слишком мало…</p>

      <p>Но мы только что исключили половину чисел! Теперь мы знаем, что все числа 1-50 меньше загаданного.</p>

      <p>— Следующая попытка: 75.<br />
— На этот раз перелет…</p>

      <p>Но мы снова исключили половину оставшихся чисел! С бинарным поиском мы каждый раз проверяем число в середине диапазона и исключаем половину оставшихся чисел.</p>

      <p>— 63 (по середине между 50 и 75)?<br />
— Много!<br />
— 57?<br />
— Да!</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="cm">/**
 * Бинарный поиск
 * @param {array} list Массив с возможными значениями
 * @param {number} item Искомое число
 */</span>
<span class="kd">function</span> <span class="nx">binarySearch</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>

<span class="err">  </span><span class="c1">// Минимальный и максимальный индекс в массиве</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">low</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">high</span> <span class="o">=</span> <span class="nx">list</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>

<span class="err">  </span><span class="cm">/* Пока минимальный индекс меньше или равен
  максимальному, находим индекс элемента в середине
  массива. И сравним число в середине массива -
  list[mid] — с искомым */</span>
<span class="err">  </span><span class="k">while</span> <span class="p">(</span><span class="nx">low</span> <span class="o">&lt;=</span> <span class="nx">high</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">mid</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">floor</span><span class="p">((</span><span class="nx">low</span> <span class="o">+</span> <span class="nx">high</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">guess</span> <span class="o">=</span> <span class="nx">list</span><span class="p">[</span><span class="nx">mid</span><span class="p">];</span>

<span class="err">    </span><span class="k">if</span> <span class="p">(</span><span class="nx">guess</span> <span class="o">===</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="k">return</span> <span class="nx">mid</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span>

<span class="err">    </span><span class="cm">/* Если число в середине больше искомого,
    тогда соответственно обновляется переменная
    high — переносим максимальную границу в меньшую
    сторону. А если догадка была слишком мала, то
    обновляется переменная low. */</span>
<span class="err">    </span><span class="k">if</span> <span class="p">(</span><span class="nx">guess</span> <span class="o">&gt;</span> <span class="nx">item</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">high</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">low</span> <span class="o">=</span> <span class="nx">mid</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
<span class="p">}</span>

<span class="kd">const</span> <span class="nx">myArr</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">9</span><span class="p">];</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">binarySearch</span><span class="p">(</span><span class="nx">myArr</span><span class="p">,</span> <span class="mi">3</span><span class="p">));</span> <span class="c1">// 1</span>
<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">binarySearch</span><span class="p">(</span><span class="nx">myArr</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span> <span class="c1">// null</span>
</code></pre></div>      </div>
    </div>
</details>
</section>

<section>
  <h2>Перетаскивание / перетягивание</h2><details class="accordion">
  <summary class="accordion__header">
    Перетаскиваемый элемент
  </summary>
  <div class="accordion__body">
      <p>Разметка:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"draggable"</span> <span class="na">id=</span><span class="s">"dragMe"</span><span class="nt">&gt;</span>Drag me<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Стили:</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nx">draggable</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Indicate the element draggable</span>
<span class="err">    </span><span class="nx">cursor</span><span class="p">:</span> <span class="nx">move</span><span class="p">;</span>

<span class="err">    </span><span class="c1">// It will be positioned absolutely</span>
<span class="err">    </span><span class="nx">position</span><span class="p">:</span> <span class="nx">absolute</span><span class="p">;</span>

<span class="err">    </span><span class="c1">// Doesn't allow to select the content inside</span>
<span class="err">    </span><span class="nx">user</span><span class="o">-</span><span class="nx">select</span><span class="p">:</span> <span class="nx">none</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
</code></pre></div>      </div>

      <p>Чтобы сделать элемент перетаскиваемым, нам нужно отслеживать три события:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">mousedown</code> позволит нам определить текущее положение мыши;</li>
        <li><code class="language-plaintext highlighter-rouge">mousemove</code> даст возможность рассчитать как далеко мышка передвинулась и где сейчас находится перетаскиваемый элемент;</li>
        <li><code class="language-plaintext highlighter-rouge">mouseup</code> на этом событии удалим обработчики, установленные с предыдущими двумя.</li>
      </ul>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Текущая позиция мышки</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragMe</span><span class="dl">'</span><span class="p">);</span>

<span class="cm">/** Отслеживаем передвижение */</span>
<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко курсор передвинулся</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Устанавливаем позицию элемента</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">el</span><span class="p">.</span><span class="nx">offsetTop</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">el</span><span class="p">.</span><span class="nx">offsetLeft</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Переопределяем позицию курсора</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/** Удаляем обработчики на прекращении перетаскивания */</span>
<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Remove the handlers of `mousemove` and `mouseup`</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/** Добавляем обработчики перед перетаскиванием */</span>
<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем координаты курсора</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Устанавливаем слушатели на документ</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span><span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Масштабируемый элемент
  </summary>
  <div class="accordion__body">
      <p>Разметка:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"resizable"</span> <span class="na">id=</span><span class="s">"resize-me"</span><span class="nt">&gt;</span>Resize me<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Добавим дополнительные <code class="language-plaintext highlighter-rouge">div</code>‘ы вдоль краев объекта. Они нужны, как ручки для перетягивания — границы элемента не являются DOM-узлами. Чтобы упростить пример, добавим их только снизу и справа.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"resize-me"</span> <span class="na">class=</span><span class="s">"resizable"</span><span class="nt">&gt;</span>
  Resize me
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"resizer is-right"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"resizer is-bottom"</span><span class="nt">&gt;&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Here is the basic styles for the layout:</p>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.resizable</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.resizer</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">cursor</span><span class="p">:</span> <span class="n">row-resize</span><span class="p">;</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
<span class="err">  </span><span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.is-right</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.is-bottom</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">bottom</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>Как во всех случаях с перемещением объектов интерфейса курсором мыши, создадим обработчики для трёх событий.</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">mousedown</code> — добавляем обработчик на ручки перетягивания для отслеживания позиции курсора и получения исходных габаритов объекта.</li>
        <li><code class="language-plaintext highlighter-rouge">mousemove</code> — добавляем обработчик на документ, чтобы рассчитать, как далеко курсор передвинулся и новые размеры элемента.</li>
        <li><code class="language-plaintext highlighter-rouge">mouseup</code> — добавляем обработчик на документ, чтобы удалить обработчик <code class="language-plaintext highlighter-rouge">mousemove</code> и самого себя.</li>
      </ul>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">resize-me</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Текущая позиция курсора</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Размеры элемента</span>
<span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко перемещен курсор</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Обновляем размеры элемента</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">w</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">h</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/* Удаляем обработчики */</span>
<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/** Обработчик срабатывает в начале перетаскивания */</span>
<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Текущая позиция курсора</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>
<span class="err">  </span>
<span class="err">  </span><span class="c1">// Измеряем элемент</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">el</span><span class="p">);</span>
<span class="err">  </span><span class="nx">w</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="err">  </span><span class="nx">h</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">height</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">  </span><span class="cm">/* Устанавливаем слушатели с обработчиками
  на документ */</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Все обработчики готовы. Теперь добавляем обработчик <code class="language-plaintext highlighter-rouge">mousedown</code> на ручки.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">resizers</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.resizer</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">resizers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">resizer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/make-a-resizable-element/" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Сортировка элементов списка перетаскиванием
  </summary>
  <div class="accordion__body">
      <p>Разметка и стили:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;style&gt;</span>
<span class="err">  </span><span class="nc">.draggable</span> <span class="p">{</span>
<span class="err">    </span><span class="nl">cursor</span><span class="p">:</span> <span class="n">move</span><span class="p">;</span>
<span class="err">    </span><span class="py">user-select</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"list"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"draggable"</span><span class="nt">&gt;</span>A<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"draggable"</span><span class="nt">&gt;</span>B<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"draggable"</span><span class="nt">&gt;</span>C<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"draggable"</span><span class="nt">&gt;</span>D<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"draggable"</span><span class="nt">&gt;</span>E<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-9">Делаем элементы перетягиваемыми</h4>

      <p>Используем технику, описанную в разделе «<a href="#topic-draggable-base">Перетягиваемый элемент</a>».</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Элемент, перетаскиваемый в данный момент</span>
<span class="kd">let</span> <span class="nx">draggingEl</span><span class="p">;</span>

<span class="c1">// Текущая позиция курсора относительно перетаскиваемого элемента</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/** Перетаскивание в процессе */</span>
<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Устанавливаем позицию перетаскиваемого элемента</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">absolute</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">y</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="p">};</span>

<span class="cm">/** Перетаскивание закончилось.
  * Удаляем стили позиционирования перетаскиваемого
  * элемента и слушатели
  */</span>
<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Remove the position styles</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">top</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">left</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">position</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
<span class="err">  </span><span class="nx">draggingEl</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Удаляем слушатели `mousemove` и `mouseup`</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/** Перетаскивание начинается */</span>
<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">draggingEl</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Рассчитываем позицию курсора</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">draggingEl</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageX</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">pageY</span> <span class="o">-</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Устанавливаем слушатели на документ</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>

<span class="cm">/* Теперь установим слушатели `mousedown`
на каждый элемент списка */</span>
<span class="kd">const</span> <span class="nx">listItems</span> <span class="o">=</span> <span class="nb">document</span>
<span class="err">  </span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">list</span><span class="dl">'</span><span class="p">)</span>
<span class="err">  </span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">.dragable</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">listItems</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">item</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-10">Добавим заглушку</h4>

      <p>Во время перетаскивания списка, место элемента, изъятого из потока, смыкается. Например, место перетягиваемого элемента <code class="language-plaintext highlighter-rouge">C</code> сразу же займет его «сосед снизу» — <code class="language-plaintext highlighter-rouge">D</code>. Это может нарушить спокойствие пользователя и, чтобы предупредить такие сдвиги, надо создать заглушку той же высоты, что и изъятый элемент.</p>

      <p>Заглушка создается в начале перетягивания.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">placeholder</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">draggingRect</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDraggingStarted</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Обновляем флаг</span>
<span class="err">  </span><span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Создаем заглушку</span>
<span class="err">  </span><span class="nx">placeholder</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">placeholder</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">placeholder</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span>
<span class="err">    </span><span class="nx">placeholder</span><span class="p">,</span>
<span class="err">    </span><span class="nx">draggingEl</span><span class="p">.</span><span class="nx">nextSibling</span>
<span class="err">  </span><span class="p">);</span>

<span class="err">  </span><span class="cm">/* Задаем высоту заглушке — такую же,
  как у изъятого элемента */</span>
<span class="err">  </span><span class="nx">placeholder</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">draggingRect</span><span class="p">.</span><span class="nx">height</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Заглушка удаляется, как только пользователь отпустит перетаскиваемый элемент.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Удаляем</span>
<span class="err">  </span><span class="nx">placeholder</span> <span class="o">&amp;&amp;</span>
<span class="err">    </span><span class="nx">placeholder</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">  </span><span class="c1">// Восстанавливаем флаг</span>
<span class="err">  </span><span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>В итоге в момент перетаскивания элемента <code class="language-plaintext highlighter-rouge">C</code> узлы списка в DOM выстраиваются в такую последовательность:</p>

      <div class="language-text highlighter-rouge"><div class="highlight"><pre class="highlight"><code>A
B
«заглушка»
C — перетаскиваемый элемент
D
E
</code></pre></div>      </div>

      <h4 id="section-11">Определяем куда пользователь перетягивает элемент: вверх или вниз</h4>

      <p>Во-первых, нам потребуется вспомогательная функция, определяющая в каком положении находится перетаскиваемый элемент в текущий момент: сверху или снизу указанного в параметре соседа.</p>

      <p>Элемент <code class="language-plaintext highlighter-rouge">nodeA</code> считается выше элемента <code class="language-plaintext highlighter-rouge">nodeB</code>, если значение вертикального центра <code class="language-plaintext highlighter-rouge">nodeA</code> меньше аналогичного значения <code class="language-plaintext highlighter-rouge">nodeB</code>.</p>

      <p>Вертикальный центр рассчитывается как сумма координаты <code class="language-plaintext highlighter-rouge">top</code> элемента и половины его высоты.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">isAbove</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="nx">nodeB</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем границы элементов</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rectA</span> <span class="o">=</span> <span class="nx">nodeA</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rectB</span> <span class="o">=</span> <span class="nx">nodeB</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="err">  </span><span class="k">return</span> <span class="p">(</span>
<span class="err">    </span><span class="nx">rectA</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">rectA</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">&lt;</span>
<span class="err">    </span><span class="nx">rectB</span><span class="p">.</span><span class="nx">top</span> <span class="o">+</span> <span class="nx">rectB</span><span class="p">.</span><span class="nx">height</span> <span class="o">/</span> <span class="mi">2</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Как только пользователь начинает перетаскивание, мы определяем соседей выбранного — снизу и сверху.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="cm">/* Порядок элементов:
     prevEl
     draggingEl
     placeholder
     nextEl */</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">prevEl</span> <span class="o">=</span> <span class="nx">draggingEl</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">nextEl</span> <span class="o">=</span> <span class="nx">placeholder</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Если пользователь перетаскивает элемент вверх, мы меняем местами заглушку и соседа сверху.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>

<span class="err">  </span><span class="c1">// Пользователь тащит элемент вверх</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">prevEl</span> <span class="o">&amp;&amp;</span> <span class="nx">isAbove</span><span class="p">(</span><span class="nx">draggingEl</span><span class="p">,</span> <span class="nx">prevEl</span><span class="p">))</span> <span class="p">{</span>
<span class="err">    </span><span class="cm">/* Изменение порядка: исходный -&gt; новый
       prevEl                     -&gt; placeholder
       draggingEl                  -&gt; draggingEl
       placeholder                 -&gt; prevEl */</span>
<span class="err">    </span><span class="nx">swap</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">draggingEl</span><span class="p">);</span>
<span class="err">    </span><span class="nx">swap</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">prevEl</span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Если пользователь перетаскивает элемент вниз, мы меняем местами заглушку и соседа снизу.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>

<span class="err">  </span><span class="c1">// User moves the dragging element to the bottom</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">nextEl</span> <span class="o">&amp;&amp;</span> <span class="nx">isAbove</span><span class="p">(</span><span class="nx">nextEl</span><span class="p">,</span> <span class="nx">draggingEl</span><span class="p">))</span> <span class="p">{</span>
<span class="err">    </span><span class="cm">/* Изменение порядка: исходный -&gt; новый
       draggingEl                  -&gt; nextEl
       placeholder                 -&gt; placeholder
       nextEl                      -&gt; draggingEl */</span>
<span class="err">    </span><span class="nx">swap</span><span class="p">(</span><span class="nx">nextEl</span><span class="p">,</span> <span class="nx">placeholder</span><span class="p">);</span>
<span class="err">    </span><span class="nx">swap</span><span class="p">(</span><span class="nx">nextEl</span><span class="p">,</span> <span class="nx">draggingEl</span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Полная функция для изменения порядка элементов списка:</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">swap</span> <span class="o">=</span> <span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="nx">nodeB</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">parentA</span> <span class="o">=</span> <span class="nx">nodeA</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">siblingA</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">nodeA</span><span class="p">.</span><span class="nx">nextSibling</span> <span class="o">===</span> <span class="nx">nodeB</span>
<span class="err">      </span><span class="p">?</span> <span class="nx">nodeA</span>
<span class="err">      </span><span class="p">:</span> <span class="nx">nodeA</span><span class="p">.</span><span class="nx">nextSibling</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Поднимаем `nodeA` выше `nodeB`</span>
<span class="err">  </span><span class="nx">nodeB</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">nodeA</span><span class="p">,</span> <span class="nx">nodeB</span><span class="p">);</span>

<span class="err">  </span><span class="cm">/* Поднимаем `nodeB` выше соседа элемента `nodeA`
  верхнего или нижнего определяется в тернарном
  операторе выше */</span>
<span class="err">  </span><span class="nx">parentA</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">nodeB</span><span class="p">,</span> <span class="nx">siblingA</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/drag-and-drop-element-in-a-list/index.html" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Оформление виртуальной проекции перетягиваемого элемента
  </summary>
  <div class="accordion__body">
      <p>По умолчанию браузер создает полупрозрачного виртуального двойника перетягиваемого элемента. Но его можно еще и оформить по собственному смотрению.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"is-draggable"</span> <span class="na">draggable=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  Перенеси меня
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragMe</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Виртуальная проекция</span>
<span class="kd">let</span> <span class="nx">ghostEle</span><span class="p">;</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragstart</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Создаем виртуальную проекцию</span>
<span class="err">  </span><span class="nx">ghostEle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">ghostEle</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">is-dragging</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">ghostEle</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Уиии!</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">ghostEle</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Заменяем проекцию по умолчанию пользовательской</span>
<span class="err">  </span><span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setDragImage</span><span class="p">(</span><span class="nx">ghostEle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// По окончанию перетягивания виртуальную проекцию следует удалить.</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragend</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">ghostEle</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Также можно использовать заранее подготовленную разметку.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"is-draggable"</span> <span class="na">draggable=</span><span class="s">"true"</span><span class="nt">&gt;</span>
  Перенеси меня
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"is-dragging"</span> <span class="na">id=</span><span class="s">"ghost"</span><span class="nt">&gt;</span>
  Уиии!
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Обработчик события не сильно изменится.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">ghostEle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">ghost</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragstart</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">e</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nx">setDragImage</span><span class="p">(</span><span class="nx">ghostEle</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Прокрутка перетягиванием, перетягивание «холста»
  </summary>
  <div class="accordion__body">
      <p>Кроме традиционной прокрутки некоторые приложения предлагают прокрутку перетягиванием — например, передвижение холста в Photoshop и Figma с зажатым пробелом.</p>

      <p>Разметка и стили.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;style&gt;</span>
<span class="err">  </span><span class="nc">.container</span> <span class="p">{</span>
<span class="err">    </span><span class="nl">cursor</span><span class="p">:</span> <span class="n">grab</span><span class="p">;</span>
<span class="err">    </span><span class="nl">overflow</span><span class="p">:</span> <span class="nb">auto</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"container"</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>...<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-12">Прокрутка в указанное положение</h4>

      <p>Поскольку благодаря <code class="language-plaintext highlighter-rouge">overflow: auto;</code> содержание контейнера становится прокручиваемым, мы можем прокрутить его до указанной точки с помощью свойств <code class="language-plaintext highlighter-rouge">scrollTop</code> и <code class="language-plaintext highlighter-rouge">scrollLeft</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">container</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="mi">100</span><span class="p">;</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">=</span> <span class="mi">150</span><span class="p">;</span>
</code></pre></div>      </div>

      <h4 id="section-13">Теперь то же самое — перетягиванием</h4>

      <p>Используем технику, описанную в разделе «<a href="#topic-draggable-base">Перетягиваемый элемент</a>».</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span> <span class="na">top</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">left</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">x</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="na">y</span><span class="p">:</span> <span class="mi">0</span> <span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">pos</span> <span class="o">=</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Текущее положение прокрутки</span>
<span class="err">    </span><span class="na">left</span><span class="p">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">scrollLeft</span><span class="p">,</span>
<span class="err">    </span><span class="na">top</span><span class="p">:</span> <span class="nx">el</span><span class="p">.</span><span class="nx">scrollTop</span><span class="p">,</span>
<span class="err">    </span><span class="c1">// Получить положение мыши</span>
<span class="err">    </span><span class="na">x</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">,</span>
<span class="err">    </span><span class="na">y</span><span class="p">:</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">,</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>В объекте <code class="language-plaintext highlighter-rouge">pos</code> сохраняются положение курсора и прокрутки. (Объект, кстати, предпочтительней четырех переменных, так как объединяет логически связанные значения).</p>

      <p>Когда пользователь передвигает мышь, мы замеряем, насколько далеко, и затем прокручиваем содержимое в ту же точку.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко перемещен курсор</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">x</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Прокручиваем элемент</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">scrollTop</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">top</span> <span class="o">-</span> <span class="nx">dy</span><span class="p">;</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">scrollLeft</span> <span class="o">=</span> <span class="nx">pos</span><span class="p">.</span><span class="nx">left</span> <span class="o">-</span> <span class="nx">dx</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Опыт взаимодействия в процессе перетягивания может быть улучшен, с помощью пары CSS-свойств.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Change the cursor and prevent user from selecting the text</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">grabbing</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">userSelect</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>

<span class="cm">/** По окончании перетягивания */</span>
<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Меняем курсор и разрешаем выделение</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">grab</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">user-select</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Перетаскивание строки в таблице
  </summary>
  <div class="accordion__body">
      <p>Техника основана на <a href="#topic-dnd-li">перетягивании элементов списка</a>. Идея заключается в том, чтобы создавать дубликат строк таблицы в виде списка — как только пользователь начинает тянуть. На время перетягивания мы показываем только этот список (каждый элемент — клон строки), а таблицу прячем.</p>

      <p>Также во время перетягивания мы определяем порядковый номер перетаскиваемого элемента списка. И переносим соответствующую строку исходной таблицы до или после «строки назначения».</p>

      <h4 id="section-14">Обработчики событий</h4>

      <p>Как нам известно из раздела о <a href="#topic-dnd-li">перетягивании элементов списка</a>, первым делом надо создать обработчики для трёх событий.</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">mousedown</code> — добавляем обработчик на первые ячейки строк.</li>
        <li><code class="language-plaintext highlighter-rouge">mousemove</code> — добавляем обработчик на документ для создания и вставки «заглушки» на время перетаскивания.</li>
        <li><code class="language-plaintext highlighter-rouge">mouseup</code> — событие окончания перетаскивания.</li>
      </ul>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code>`<span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"table"</span><span class="nt">&gt;</span>
...
<span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">table</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">  </span><span class="p">};</span>
<span class="err">  </span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span><span class="err">  </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">    </span><span class="c1">// Удаляем обработчики `mousemove` и `mouseup`</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">};</span>
<span class="err">  </span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">  </span>
<span class="err">    </span><span class="c1">// Устанавливаем слушатели</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">};</span>
<span class="err">  </span>
<span class="err">  </span><span class="c1">// Добавляем обработчики начала перетаскивания</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">).</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">row</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Игнорируем первую строку — фактический thead.</span>
<span class="err">    </span><span class="k">if</span> <span class="p">(</span><span class="nx">index</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="k">return</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span>
<span class="err">    </span><span class="c1">// Первая ячейка строки</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">firstCell</span> <span class="o">=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">firstElementChild</span><span class="p">;</span>
<span class="err">    </span><span class="nx">firstCell</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">draggable</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">    </span><span class="c1">// Устанавливаем слушатели</span>
<span class="err">    </span><span class="nx">firstCell</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-15">Клонируем таблицу, когда пользователь тащит строку</h4>

      <p>Во-первых, нам нужен флаг, чтобы помечать, когда происходит перетягивание.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDraggingStarted</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="err">    </span><span class="nx">cloneTable</span><span class="p">();</span>
<span class="err">  </span><span class="p">}</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Функция <code class="language-plaintext highlighter-rouge">cloneTable</code> создает клон таблицы и показывает его вместо таблицы.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">list</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">cloneTable</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем границы таблицы</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="err">  </span><span class="c1">// Получаем ширину таблицы</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span>
<span class="err">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">table</span><span class="p">).</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">  </span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Создаем псевдосписок</span>
<span class="err">  </span><span class="nx">list</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Устанавливаем его по координатам таблицы</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">absolute</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Вставляем до таблицы</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">table</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Таблицу скрываем</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Лист будет состоять из клонов строк.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">list</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">cloneTable</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем границы таблицы</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="err">  </span><span class="c1">// Получаем ширину таблицы</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span>
<span class="err">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">table</span><span class="p">).</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">  </span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Создаем псевдосписок</span>
<span class="err">  </span><span class="nx">list</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Устанавливаем его по координатам таблицы</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">absolute</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Вставляем до таблицы</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">table</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Таблицу скрываем</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>После клонирования в DOM у нас должна добавиться такая конструкция.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Список --&gt;</span>
<span class="nt">&lt;div&gt;</span>
  <span class="c">&lt;!-- Первый элемент… --&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;table&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        <span class="c">&lt;!-- …содержит клон первой строки
        исходной таблицы --&gt;</span>
      <span class="nt">&lt;/tr&gt;</span>
    <span class="nt">&lt;/table&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="c">&lt;!-- Второй элемент и т. д. --&gt;</span>
<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;table&gt;</span><span class="c">&lt;!-- Исходная таблица --&gt;</span><span class="nt">&lt;/table&gt;</span>
</code></pre></div>      </div>

      <p>Теперь нам нужно установить ширину ячеек, чтобы сделать дубликат таблицы похожим на оригинал.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">newCell</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="err">  </span><span class="c1">// Устанавливаем ширину оригинальной ячейки</span>
<span class="err">  </span><span class="nx">newCell</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nb">parseInt</span><span class="p">(</span>
<span class="err">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">cell</span><span class="p">).</span><span class="nx">width</span><span class="p">,</span>
<span class="err">    </span><span class="mi">10</span>
<span class="err">  </span><span class="p">)}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">newRow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newCell</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Определяем индексы перетаскиваемой и целевой строки.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Перетаскиваемый элемент</span>
<span class="kd">let</span> <span class="nx">draggingEl</span><span class="p">;</span>
<span class="c1">// Индекс Перетаскиваемой строки</span>
<span class="kd">let</span> <span class="nx">draggingRowIndex</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем исходную строку</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">originalRow</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">;</span>
<span class="err">  </span><span class="nx">draggingRowIndex</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">    </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">))</span>
<span class="err">    </span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">originalRow</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDraggingStarted</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">cloneTable</span><span class="p">();</span>

<span class="err">    </span><span class="c1">// Получаем перетягиваемый элемент</span>
<span class="err">    </span><span class="nx">draggingEl</span> <span class="o">=</span>
<span class="err">      </span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">children</span><span class="p">)[</span><span class="nx">draggingRowIndex</span><span class="p">];</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем индекс целевой строки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">endRowIndex</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">    </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span>
<span class="err">    </span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">draggingEl</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>После того, как мы получили <code class="language-plaintext highlighter-rouge">draggingRowIndex</code> и <code class="language-plaintext highlighter-rouge">endRowIndex</code>, нетрудно определить, где пользователь отпустит перетаскиваемый элемент — сверху или снизу от исходной точки. И теперь мы можем решить, куда пристроить целевую строку: до или после нового места перетаскиваемой.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Переносим перетаскиваемую строку к `endRowIndex`</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rows</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">));</span>
<span class="err">  </span><span class="nx">draggingRowIndex</span> <span class="o">&gt;</span> <span class="nx">endRowIndex</span>
<span class="err">    </span><span class="p">?</span> <span class="c1">// Пользователь отпустил сверху</span>
<span class="err">      </span><span class="nx">rows</span><span class="p">[</span><span class="nx">endRowIndex</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span>
<span class="err">        </span><span class="nx">rows</span><span class="p">[</span><span class="nx">draggingRowIndex</span><span class="p">],</span>
<span class="err">        </span><span class="nx">rows</span><span class="p">[</span><span class="nx">endRowIndex</span><span class="p">]</span>
<span class="err">      </span><span class="p">)</span>
<span class="err">    </span><span class="p">:</span> <span class="c1">// Пользователь отпустил снизу</span>
<span class="err">      </span><span class="nx">rows</span><span class="p">[</span><span class="nx">endRowIndex</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span>
<span class="err">        </span><span class="nx">rows</span><span class="p">[</span><span class="nx">draggingRowIndex</span><span class="p">],</span>
<span class="err">        </span><span class="nx">rows</span><span class="p">[</span><span class="nx">endRowIndex</span><span class="p">].</span><span class="nx">nextSibling</span>
<span class="err">      </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/drag-and-drop-table-row/" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Перетаскивание колонки в таблице
  </summary>
  <div class="accordion__body">
      <p>Техника основана на <a href="#topic-dnd-li">перетягивании элементов списка</a>. Идея заключается в том, чтобы создавать дубликат колонок в виде списка — как только пользователь начинает тянуть. На время перетягивания мы показываем только этот список (каждый элемент — клон колонки), а таблицу прячем.</p>

      <p>Также во время перетягивания мы определяем порядковый номер перетаскиваемого и целевого элемента списка. И меняем местами соответствующие колонки.</p>

      <h4 id="section-16">Обработчики событий</h4>

      <p>Как нам известно из раздела о <a href="#topic-dnd-li">перетягивании элементов списка</a>, первым делом надо создать обработчики для трёх событий.</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">mousedown</code> — добавляем обработчик на первые ячейки колонок, это будет функция перетягивания их клонов.</li>
        <li><code class="language-plaintext highlighter-rouge">mousemove</code> — добавляем обработчик на документ для создания и вставки «заглушки» на время перетаскивания.</li>
        <li><code class="language-plaintext highlighter-rouge">mouseup</code> — событие окончания перетаскивания.</li>
      </ul>

      <p>Разметка и «каркас» скрипта.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"table"</span><span class="nt">&gt;</span><span class="c">&lt;!-- ... --&gt;</span><span class="nt">&lt;/table&gt;</span>

<span class="nt">&lt;script&gt;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">table</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">    </span><span class="c1">// Удаляем обработчики `mousemove` и `mouseup`</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// ...</span>

<span class="err">    </span><span class="c1">// Добавляем обработчики на документ</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="c1">// Добавляем обработчики начала перетаскивания</span>
<span class="err">  </span><span class="nx">table</span>
<span class="err">    </span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">)</span>
<span class="err">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">headerCell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">headerCell</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">        </span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span>
<span class="err">      </span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>
<span class="nt">&lt;/script&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-17">Клонируем таблицу, когда пользователь перетягивает колонку</h4>

      <p>Во-первых, нам нужен флаг, чтобы помечать, когда происходит перетягивание.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDraggingStarted</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">isDraggingStarted</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>

<span class="err">    </span><span class="nx">cloneTable</span><span class="p">();</span>
<span class="err">  </span><span class="p">}</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Функция <code class="language-plaintext highlighter-rouge">cloneTable</code> создает клон таблицы и показывает его вместо таблицы.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">let</span> <span class="nx">list</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">cloneTable</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем границы таблицы</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>

<span class="err">  </span><span class="cm">/* Создает список — не семантический `ul`,
  простой `div` */</span>
<span class="err">  </span><span class="nx">list</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Устанавливаем его по координатам таблицы</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">position</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">absolute</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">rect</span><span class="p">.</span><span class="nx">left</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">list</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">top</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">rect</span><span class="p">.</span><span class="nx">top</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// В коде вставляем перед таблицей</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span><span class="nx">list</span><span class="p">,</span> <span class="nx">table</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Прячем таблицу</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Лист будет состоять из клонов колонок.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cloneTable</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="c1">// ...</span>

<span class="cm">/* Получаем поверхностную копию всех td.
Делаем из NodeList массив, чтобы применить
позже метод `filter`.*/</span>
<span class="kd">const</span> <span class="nx">originalCells</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
<span class="err">    </span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tbody td</span><span class="dl">'</span><span class="p">)</span>
<span class="p">);</span>

<span class="cm">/* Получаем поверхностную копию всех th.
В данном случае не уверен ыв необходимости
`[].slice.call`, так как `NodeList` имеет
свойство `length` и метод `forEach` */</span>
<span class="kd">const</span> <span class="nx">originalHeaderCells</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
<span class="err">    </span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">)</span>
<span class="p">);</span>

<span class="kd">const</span> <span class="nx">numColumns</span> <span class="o">=</span> <span class="nx">originalHeaderCells</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

<span class="c1">// Перебираем все th</span>
<span class="err">  </span><span class="nx">originalHeaderCells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span>
<span class="err">    </span><span class="p">(</span><span class="nx">headerCell</span><span class="p">,</span> <span class="nx">headerIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span>
<span class="err">        </span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">headerCell</span><span class="p">).</span><span class="nx">width</span><span class="p">,</span>
<span class="err">        </span><span class="mi">10</span>
<span class="err">      </span><span class="p">);</span>

<span class="err">      </span><span class="cm">/* Создаем список и новую таблицу
      из первой строки исходной */</span><span class="err">  </span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="err">      </span><span class="nx">item</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">draggable</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">newTable</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">table</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">      </span><span class="cm">/* Строка заголовков th
      (семантически — потомок thead) */</span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">th</span> <span class="o">=</span> <span class="nx">headerCell</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="err">      </span><span class="kd">let</span> <span class="nx">newRow</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">);</span>
<span class="err">      </span><span class="nx">newRow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">th</span><span class="p">);</span>
<span class="err">      </span><span class="nx">newTable</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newRow</span><span class="p">);</span>
<span class="err">  </span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">cells</span> <span class="o">=</span> <span class="nx">originalCells</span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">c</span><span class="p">,</span> <span class="nx">idx</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">        </span><span class="k">return</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">-</span> <span class="nx">headerIndex</span><span class="p">)</span> <span class="o">%</span> <span class="nx">numColumns</span> <span class="o">===</span> <span class="mi">0</span><span class="p">;</span>
<span class="err">      </span><span class="p">});</span>
<span class="err">  </span>
<span class="err">      </span><span class="nx">cells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">        </span><span class="kd">const</span> <span class="nx">newCell</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="err">        </span><span class="nx">newRow</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">);</span>
<span class="err">        </span><span class="nx">newRow</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newCell</span><span class="p">);</span>
<span class="err">        </span><span class="nx">newTable</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newRow</span><span class="p">);</span>
<span class="err">      </span><span class="p">});</span>
<span class="err">  </span>
<span class="err">      </span><span class="nx">item</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newTable</span><span class="p">);</span>
<span class="err">      </span><span class="nx">list</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">item</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>После клонирования в DOM у нас должна добавиться такая конструкция.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Список --&gt;</span>
<span class="nt">&lt;div&gt;</span>
  <span class="c">&lt;!-- Первый элемент… --&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;table&gt;</span>
      <span class="c">&lt;!-- …содержит клон первой колонки
      исходной таблицы --&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        ...
      <span class="nt">&lt;/tr&gt;</span>
      <span class="nt">&lt;tr&gt;</span>
        ...
      <span class="nt">&lt;/tr&gt;</span>
      ...
    <span class="nt">&lt;/table&gt;</span>
  <span class="nt">&lt;/div&gt;</span>

  <span class="c">&lt;!-- Второй элемент и т. д. --&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="nt">&lt;table&gt;</span><span class="c">&lt;!-- Исходная таблица --&gt;</span><span class="nt">&lt;/table&gt;</span>
</code></pre></div>      </div>

      <p>Теперь нам нужно установить ширину ячеек, чтобы сделать дубликат таблицы похожим на оригинал.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">originalHeaderCells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">headerCell</span><span class="p">,</span> <span class="nx">headerIndex</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем ширину оригинальной ячейки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span>
<span class="err">    </span><span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">headerCell</span><span class="p">).</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span>
<span class="err">  </span><span class="p">);</span>

<span class="err">  </span><span class="nx">newTable</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">width</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="nx">cells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">newCell</span> <span class="o">=</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">cloneNode</span><span class="p">(</span><span class="kc">true</span><span class="p">);</span>
<span class="err">    </span><span class="nx">newCell</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">width</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Определяем индексы перетаскиваемой и целевой колонки.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Перетаскиваемый элемент</span>
<span class="kd">let</span> <span class="nx">draggingEl</span><span class="p">;</span>
<span class="c1">// Индекс перетаскиваемой колонки</span>
<span class="kd">let</span> <span class="nx">draggingRowIndex</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем индекс перетаскиваемой колонки</span>
<span class="err">  </span><span class="nx">draggingColumnIndex</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">    </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">))</span>
<span class="err">    </span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">isDraggingStarted</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">cloneTable</span><span class="p">();</span>

<span class="err">    </span><span class="c1">// Получаем перетаскиваемый элемент</span>
<span class="err">    </span><span class="nx">draggingEl</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">      </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">children</span><span class="p">)[</span><span class="nx">draggingColumnIndex</span><span class="p">];</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем индекс последней колонки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">endColumnIndex</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">    </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">list</span><span class="p">.</span><span class="nx">children</span><span class="p">)</span>
<span class="err">    </span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">draggingEl</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>После того, как мы получили <code class="language-plaintext highlighter-rouge">draggingColumnIndex</code> и <code class="language-plaintext highlighter-rouge">endColumnIndex</code>, нетрудно определить, где пользователь отпустит перетаскиваемый элемент — справа или слева от исходной точки. И теперь мы можем решить, куда пристроить целевую колонку: до или после нового места перетаскиваемой.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Двигаем перетаскиваемую колонку к `endColumnIndex`</span>
<span class="err">  </span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">).</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">row</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">cells</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span>
<span class="err">      </span><span class="nx">row</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th, td</span><span class="dl">'</span><span class="p">)</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nx">draggingColumnIndex</span> <span class="o">&gt;</span> <span class="nx">endColumnIndex</span>
<span class="err">      </span><span class="p">?</span> <span class="nx">cells</span><span class="p">[</span><span class="nx">endColumnIndex</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span>
<span class="err">          </span><span class="nx">cells</span><span class="p">[</span><span class="nx">draggingColumnIndex</span><span class="p">],</span>
<span class="err">          </span><span class="nx">cells</span><span class="p">[</span><span class="nx">endColumnIndex</span><span class="p">]</span>
<span class="err">        </span><span class="p">)</span>
<span class="err">      </span><span class="p">:</span> <span class="nx">cells</span><span class="p">[</span><span class="nx">endColumnIndex</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">insertBefore</span><span class="p">(</span>
<span class="err">          </span><span class="nx">cells</span><span class="p">[</span><span class="nx">draggingColumnIndex</span><span class="p">],</span>
<span class="err">          </span><span class="nx">cells</span><span class="p">[</span><span class="nx">endColumnIndex</span><span class="p">].</span><span class="nx">nextSibling</span>
<span class="err">        </span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/drag-and-drop-table-column/" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
</section>

<section>
  <h2>Изображения, ifram'ы, файлы и таблицы</h2><details class="accordion">
  <summary class="accordion__header">
    Заменить «битые» изображения
  </summary>
  <div class="accordion__body">
      <p>Вместо ненайденных картинок показывать картинку с соответствующим сообщением.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Находим все картинки…</span>
<span class="kd">const</span> <span class="nx">images</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">img</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// и перебираем</span>
<span class="nx">images</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">el</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/path/to/404/image.png</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Вставить изображение из буфера обмена
  </summary>
  <div class="accordion__body">
      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Устанавливаем слушатель события `paste`</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">paste</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>

<span class="err">  </span><span class="c1">// Получаем данные из буфера</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">clipboardItems</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clipboardData</span><span class="p">.</span><span class="nx">items</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">items</span> <span class="o">=</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">    </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">clipboardItems</span><span class="p">)</span>
<span class="err">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">item</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span>
<span class="err">    </span><span class="c1">// Фильтруем: только картинки</span>
<span class="err">    </span><span class="k">return</span> <span class="nx">item</span><span class="p">.</span><span class="nx">type</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">)</span> <span class="o">!==</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="err">  </span><span class="p">});</span>

<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">items</span><span class="p">.</span><span class="nx">length</span> <span class="o">===</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="k">return</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">item</span> <span class="o">=</span> <span class="nx">items</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="err">  </span><span class="c1">// Получаем картинку, как объект `File`</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="nx">item</span><span class="p">.</span><span class="nx">getAsFile</span><span class="p">();</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Теперь мы можем увидеть картинку на странице, предположим, в «заглушке» <code class="language-plaintext highlighter-rouge">img#preview</code>. Для это в слушатель, после создания <code class="language-plaintext highlighter-rouge">blob</code> получаем этот элемент и устанавливаем его атрибут <code class="language-plaintext highlighter-rouge">src</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">imageEle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">preview</span><span class="dl">'</span><span class="p">);</span>
<span class="nx">imageEle</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>А можем отослать на сервер в AJAX-запросе. (Код нужно вставить в том же слушателе).</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Создаем новую FormData</span>
<span class="kd">const</span> <span class="nx">formData</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FormData</span><span class="p">();</span>
<span class="nx">formData</span><span class="p">.</span><span class="nx">append</span><span class="p">(</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">,</span> <span class="nx">blob</span><span class="p">,</span> <span class="dl">'</span><span class="s1">filename</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Создает запрос. Лучше использовать `fetch` — см. ниже</span>
<span class="kd">const</span> <span class="nx">request</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">XMLHttpRequest</span><span class="p">();</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">open</span><span class="p">(</span><span class="dl">'</span><span class="s1">POST</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">/path/to/back-end</span><span class="dl">'</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>

<span class="c1">// Обработчики «успешно» и ошибки</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&gt;=</span> <span class="mi">200</span> <span class="o">&amp;&amp;</span> <span class="nx">request</span><span class="p">.</span><span class="nx">status</span> <span class="o">&lt;</span> <span class="mi">400</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">res</span> <span class="o">=</span> <span class="nx">request</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
<span class="err">    </span><span class="c1">// Do something with the response</span>
<span class="err">    </span><span class="c1">// ...</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>

<span class="c1">// Отправляем</span>
<span class="nx">request</span><span class="p">.</span><span class="nx">send</span><span class="p">(</span><span class="nx">formData</span><span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Предпросмотр изображения перед отправкой на сервер
  </summary>
  <div class="accordion__body">
      <p>Исходная разметка. Поле <code class="language-plaintext highlighter-rouge">\[type='file'\]</code> для выбора изображения и «заглушка» картинки.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;input</span> <span class="na">id=</span><span class="s">"input-file"</span> <span class="na">type=</span><span class="s">"file"</span><span class="nt">&gt;</span>
<span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"preview"</span><span class="nt">&gt;</span>
</code></pre></div>      </div>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">fileEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">input-file</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">previewEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">preview</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>      </div>

      <h4 id="urlcreateobjecturl">1. Используем метод <code class="language-plaintext highlighter-rouge">URL.createObjectURL()</code></h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fileEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем выбранный файл</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="err">  </span><span class="c1">// Создаем URL-объект выбранной картинки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Передаем в «заглушку» URL-объект</span>
<span class="err">  </span><span class="nx">previewEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">url</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="filereaderreadasdataurl">2. Используем метод FileReader.readAsDataURL()</h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">fileEl</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем выбранный файл</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">file</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>
<span class="err">  </span><span class="nx">reader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Передаем в «заглушку» ссылку</span>
<span class="err">    </span><span class="nx">previewEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">reader</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
<span class="err">  </span><span class="p">});</span>

<span class="err">  </span><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">file</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Растягивание и уменьшение (scale) изображения
  </summary>
  <div class="accordion__body">
      <p><strong>Задача</strong>. Масштабировать изображение на заданное в процентах значение. Для выбора картинки есть <code class="language-plaintext highlighter-rouge">#upload[type='file']</code>, для предпросмотра — пустой <code class="language-plaintext highlighter-rouge">div#preview</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">picture</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">upload</span><span class="dl">'</span><span class="p">).</span><span class="nx">files</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
<span class="kd">const</span> <span class="nx">previewEl</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">preview</span><span class="dl">'</span><span class="p">);</span>

<span class="cm">/**
* Получение объекта Blob из data URL
*
* Если браузер не поддерживает метод `canvas.toBlob`,
* конвертируем data URL изображения, полученный
* из функции `resize`, в объект Blob.
*
* @param { string } url data URL изображения
*/</span>
<span class="kd">const</span> <span class="nx">dataUrlToBlob</span> <span class="o">=</span> <span class="p">(</span><span class="nx">url</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">arr</span> <span class="o">=</span> <span class="nx">url</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">mime</span> <span class="o">=</span> <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">match</span><span class="p">(</span><span class="sr">/:</span><span class="se">(</span><span class="sr">.*</span><span class="se">?)</span><span class="sr">;/</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">str</span> <span class="o">=</span> <span class="nx">atob</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
<span class="err">  </span><span class="kd">let</span> <span class="p">{</span> <span class="nx">length</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">str</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">uintArr</span> <span class="o">=</span> <span class="k">new</span> <span class="nb">Uint8Array</span><span class="p">(</span><span class="nx">length</span><span class="p">);</span>
<span class="err">  </span><span class="k">while</span> <span class="p">(</span><span class="nx">length</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">uintArr</span><span class="p">[</span><span class="nx">length</span><span class="p">]</span> <span class="o">=</span> <span class="nx">str</span><span class="p">.</span><span class="nx">charCodeAt</span><span class="p">(</span><span class="nx">length</span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>
<span class="err">  </span><span class="k">return</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">uintArr</span><span class="p">],</span> <span class="p">{</span> <span class="na">type</span><span class="p">:</span> <span class="nx">mime</span> <span class="p">});</span>
<span class="p">};</span>

<span class="cm">/**
* Масштабирование изображения
*
* @param { object } image изображение
* @param { number } ratio коэффициент сжатия: 0.01 - 0.99
*/</span>
<span class="kd">const</span> <span class="nx">resize</span> <span class="o">=</span> <span class="p">(</span><span class="nx">image</span><span class="p">,</span> <span class="nx">ratio</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">return</span> <span class="k">new</span> <span class="nb">Promise</span><span class="p">((</span><span class="nx">resolve</span><span class="p">,</span> <span class="nx">reject</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">reader</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">FileReader</span><span class="p">();</span>

<span class="err">    </span><span class="c1">// Читаем файл</span>
<span class="err">    </span><span class="nx">reader</span><span class="p">.</span><span class="nx">readAsDataURL</span><span class="p">(</span><span class="nx">image</span><span class="p">);</span>

<span class="err">    </span><span class="c1">// После загрузки изображения</span>
<span class="err">    </span><span class="nx">reader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// Создаем объект типа `Image`</span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>
<span class="err">      </span><span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">        </span><span class="c1">// Создаем холст</span>
<span class="err">        </span><span class="kd">const</span> <span class="nx">canvas</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">canvas</span><span class="dl">'</span><span class="p">);</span>

<span class="err">        </span><span class="cm">/* Выводим на холсте заглушку масштабированного
        изображения */</span>
<span class="err">        </span><span class="kd">const</span> <span class="nx">context</span> <span class="o">=</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">getContext</span><span class="p">(</span><span class="dl">'</span><span class="s1">2d</span><span class="dl">'</span><span class="p">);</span>
<span class="err">        </span><span class="kd">const</span> <span class="nx">w</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">width</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">;</span>
<span class="err">        </span><span class="kd">const</span> <span class="nx">h</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">height</span> <span class="o">*</span> <span class="nx">ratio</span><span class="p">;</span>
<span class="err">        </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="nx">w</span><span class="p">;</span>
<span class="err">        </span><span class="nx">canvas</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="nx">h</span><span class="p">;</span>
<span class="err">        </span><span class="nx">context</span><span class="p">.</span><span class="nx">drawImage</span><span class="p">(</span><span class="nx">el</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nx">w</span><span class="p">,</span> <span class="nx">h</span><span class="p">);</span>

<span class="err">        </span><span class="c1">// Получаем данные масштабированной картинки</span>
<span class="err">        </span><span class="dl">'</span><span class="s1">toBlob</span><span class="dl">'</span> <span class="k">in</span> <span class="nx">canvas</span>
<span class="err">          </span><span class="p">?</span> <span class="nx">canvas</span><span class="p">.</span><span class="nx">toBlob</span><span class="p">((</span><span class="nx">blob</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">              </span><span class="nx">resolve</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="err">            </span><span class="p">})</span>
<span class="err">          </span><span class="p">:</span> <span class="nx">resolve</span><span class="p">(</span><span class="nx">dataUrlToBlob</span><span class="p">(</span><span class="nx">canvas</span><span class="p">.</span><span class="nx">toDataURL</span><span class="p">()));</span>
<span class="err">      </span><span class="p">});</span>

<span class="err">      </span><span class="c1">// Задаем атрибут `src`</span>
<span class="err">      </span><span class="nx">el</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">result</span><span class="p">;</span>
<span class="err">    </span><span class="p">});</span>

<span class="err">    </span><span class="nx">reader</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">error</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">reject</span><span class="p">();</span>
<span class="err">    </span><span class="p">});</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Как только мы получаем Blob масштабированной картинки, мы можем просмотреть ее на странице или отослать на сервер, как часть <code class="language-plaintext highlighter-rouge">FormData</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Уменьшаем картинку на 50%</span>
<span class="nx">resize</span><span class="p">(</span><span class="nx">picture</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">).</span><span class="nx">then</span><span class="p">((</span><span class="nx">blob</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Предпросмотр</span>
<span class="err">  </span><span class="nx">previewEl</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Приближение и удаление (zoom) изображения с помощью бегунка
  </summary>
  <div class="accordion__body">
      <p>Разметка:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c">&lt;!-- Картинка --&gt;</span>
<span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"image-container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"image"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>

<span class="c">&lt;!-- Бегунок --&gt;</span>
<span class="nt">&lt;div&gt;</span>
  <span class="c">&lt;!-- Минимальное значение --&gt;</span>
  <span class="nt">&lt;div&gt;</span>10%<span class="nt">&lt;/div&gt;</span>
  
  <span class="c">&lt;!-- Собственно бегунок --&gt;</span>
  <span class="nt">&lt;div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"left"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">id=</span><span class="s">"knob"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"right"</span><span class="nt">&gt;&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
  
  <span class="c">&lt;!-- Максимальное значение --&gt;</span>
  <span class="nt">&lt;div&gt;</span>200%<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-18">Контейнер изображения</h4>

      <p>Центрируем картинку в контейнере и обрезаем, когда она больше, чем контейнер.</p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.image-container</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
<span class="err">  </span><span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="err">  </span><span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="err">  </span>
<span class="err">  </span><span class="nl">overflow</span><span class="p">:</span> <span class="nb">hidden</span><span class="p">;</span>
<span class="err">  </span><span class="nl">width</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <h4 id="section-19">Расчет исходных габаритов</h4>

      <p>Для начала получим исходные размеры изображения. Для этого применяем небольшой трюк: создаем новую картинку, передаем в нее значение атрибута src реальной, чтобы обработать событие <code class="language-plaintext highlighter-rouge">load</code> и получить искомые данные.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">image</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">);</span>

<span class="cm">/* Создаем пустую картинку — это будет клон
пользовательской, который можно измерить */</span>
<span class="kd">const</span> <span class="nx">cloneImage</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Image</span><span class="p">();</span>

<span class="c1">// Измеряем размеры картинки на загрузке</span>
<span class="nx">cloneImage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Исходные размеры</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">width</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">naturalWidth</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">naturalHeight</span><span class="p">;</span>
<span class="err">  </span>
<span class="err">  </span><span class="c1">// Устанавливаем размеры в стиле</span>
<span class="err">  </span><span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">width</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">height</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="p">});</span>

<span class="c1">// Передаем `src` в клон</span>
<span class="nx">cloneImage</span><span class="p">.</span><span class="nx">src</span> <span class="o">=</span> <span class="nx">image</span><span class="p">.</span><span class="nx">src</span><span class="p">;</span>
</code></pre></div>      </div>

      <p>Поскольку картинка с помощью стилей вписывается в контейнер, нужно узнать насколько она масштабирована в исходном положении.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cloneImage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">scale</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">image</span>
<span class="err">      </span><span class="p">.</span><span class="nx">parentNode</span>
<span class="err">      </span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">()</span>
<span class="err">      </span><span class="p">.</span><span class="nx">width</span> <span class="o">/</span> <span class="nx">width</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Теперь восстанавливаем реальные размеры картинки, используя полученный коэффициент исходного масштабирования.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cloneImage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">//...</span>
<span class="err">  </span><span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s2">`scale(</span><span class="p">${</span><span class="nx">scale</span><span class="p">}</span><span class="s2">, </span><span class="p">${</span><span class="nx">scale</span><span class="p">}</span><span class="s2">)`</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-20">Бегунок</h4>

      <p>Подробно о бегунке <a href="#topic-range">см. здесь</a>.</p>

      <p>В этой задаче мы хотим установить бегунок согласно значению исходного масштабирования, полученного ранее.</p>

      <p>Но сначала установим пороговые значения.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">minScale</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">maxScale</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">step</span> <span class="o">=</span> <span class="p">(</span><span class="nx">maxScale</span> <span class="o">-</span> <span class="nx">minScale</span><span class="p">)</span> <span class="o">/</span> <span class="mi">100</span><span class="p">;</span>
</code></pre></div>      </div>

      <p>Бегунок может менять ширину в строковом стиле изображения, основываясь на ширине своей левой части.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">knob</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">knob</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">leftSide</span> <span class="o">=</span> <span class="nx">knob</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>

<span class="nx">cloneImage</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${(</span><span class="nx">scale</span> <span class="o">-</span> <span class="nx">minScale</span><span class="p">)</span> <span class="o">/</span> <span class="nx">step</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-21">Изменение размеров с использованием бегунка</h4>

      <p>Обновляем коэффициент масштабирования, согласно положению бегунка.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Вычисляем ширину левой части бегунка</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="p">((</span><span class="nx">leftWidth</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span> <span class="nx">containerWidth</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Устанавливаем ширину левой части</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">newLeftWidth</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>

<span class="err">  </span><span class="cm">/* Вычисляем коэффициент масштабирования и
  изменяем стиль картинки */</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">scale</span> <span class="o">=</span> <span class="nx">minScale</span> <span class="o">+</span> <span class="nx">newLeftWidth</span> <span class="o">*</span> <span class="nx">step</span><span class="p">;</span>
<span class="err">  </span><span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">transform</span> <span class="o">=</span> <span class="s2">`scale(</span><span class="p">${</span><span class="nx">scale</span><span class="p">}</span><span class="s2">, </span><span class="p">${</span><span class="nx">scale</span><span class="p">}</span><span class="s2">)`</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/zoom-an-image/index.html" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Распечатать одну картинку со страницы
  </summary>
  <div class="accordion__body">
      <p>Страницу целиком можно распечатать, вызвав команду браузера <strong>Файл</strong> ➜ <strong>Печать…</strong> (<kbd>⌘</kbd> / <kbd>Ctrl</kbd> + <kbd>P</kbd>) или вызвав функцию <code class="language-plaintext highlighter-rouge">window.print()</code>.</p>

      <p>Чтобы напечатать изображение из страницы, можно создать <code class="language-plaintext highlighter-rouge">iframe</code> с заглушкой картинки, передавть в заглушку значение <code class="language-plaintext highlighter-rouge">src</code> и вызвать <code class="language-plaintext highlighter-rouge">window.print()</code> из <code class="language-plaintext highlighter-rouge">iframe</code>.</p>

      <p>Для этого кроме собственно картинки нам понадобится кнопка печати.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;img</span> <span class="na">id=</span><span class="s">"image"</span> <span class="na">src=</span><span class="s">"/path/to/image.jpg"</span><span class="nt">&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"print"</span><span class="nt">&gt;</span>Print<span class="nt">&lt;/button&gt;</span>
</code></pre></div>      </div>

      <p>А обработчик печати вызываться из слушателя установленного на кнопку.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">printBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">print</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">printBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="iframe">Создаем временный <code class="language-plaintext highlighter-rouge">iframe</code></h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">iframe</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">);</span>

<span class="c1">// Делаем его невидимыми</span>
<span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">visibility</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">hidden</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">iframe</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/* Добавляем размекту в `srcdoc` -
https://bit.ly/3v5Iu3p */</span>
<span class="nx">iframe</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">srcdoc</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">&lt;html&gt;&lt;body&gt;&lt;/body&gt;&lt;/html&gt;</span><span class="dl">'</span>
<span class="p">);</span>

<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
</code></pre></div>      </div>

      <h4 id="iframe-">Вставляем изображение, как только <code class="language-plaintext highlighter-rouge">iframe</code> готов</h4>

      <p>Даже не смотря на то, что в <code class="language-plaintext highlighter-rouge">iframe</code> нет содержания из внешнего источника, надо дождаться его готовности.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">iframe</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Клонируем картинку</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">image</span> <span class="o">=</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">image</span><span class="dl">'</span><span class="p">).</span><span class="nx">cloneNode</span><span class="p">();</span>
<span class="err">  </span><span class="nx">image</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">maxWidth</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">100%</span><span class="dl">'</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Вставляем клон в `body` элемента `iframe`</span>
<span class="err">  </span><span class="kd">const</span> <span class="p">{</span> <span class="nx">body</span> <span class="p">}</span> <span class="o">=</span> <span class="nx">iframe</span><span class="p">.</span><span class="nx">contentDocument</span><span class="p">;</span>
<span class="err">  </span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">textAlign</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">center</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">image</span><span class="p">);</span>

<span class="err">  </span><span class="nx">image</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="cm">/* Вызываем `print`, как только картинка
    загрузилась в `iframe` */</span>
<span class="err">    </span><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">print</span><span class="p">();</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>☝️🧐 В примере использована <a href="#topic-nested-handlers">техника вложенных обработчиков</a>: слушатель <code class="language-plaintext highlighter-rouge">load</code>, установленный на картинке, вложен в слушатель <code class="language-plaintext highlighter-rouge">load</code>, установленный на <code class="language-plaintext highlighter-rouge">iframe</code>.</p>

      <h4 id="iframe-1">Удаляем <code class="language-plaintext highlighter-rouge">iframe</code></h4>

      <p>…Когда пользователь запускает печать или когда закрывает окно печати.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">iframe</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">afterprint</span><span class="dl">'</span><span class="p">,</span>
<span class="err">  </span><span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">iframe</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">iframe</span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Виджет сравнения фотографий
  </summary>
  <div class="accordion__body">
      <h4 id="section-22">Разметка</h4>

      <p>Виджет состоит из контейнера и трех компонентов.</p>

      <ul>
        <li>Сверху — <code class="language-plaintext highlighter-rouge">div</code> с фоном из измененного изображения.</li>
        <li>Ниже — передвижная грань.</li>
        <li>Внизу — исходное изображения.</li>
      </ul>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"modified-image"</span><span class="nt">&gt;&lt;/div&gt;</span>
  
  <span class="c">&lt;!-- Грань --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"cropper"</span> <span class="na">id=</span><span class="s">"drag-me"</span><span class="nt">&gt;&lt;/div&gt;</span>
  
  <span class="nt">&lt;img</span> <span class="na">src=</span><span class="s">"/original.png"</span><span class="nt">&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>В исходном положении измененное изображение обрезано пополам.</p>

      <div class="language-scss highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.modified-image</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">background</span><span class="p">:</span> <span class="sx">url('/modified.png')</span> <span class="nb">no-repeat</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">background-size</span><span class="p">:</span> <span class="nb">auto</span> <span class="m">100%</span><span class="p">;</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
<span class="err">  </span><span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span><span class="err">  
  </span><span class="nl">left</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>

<span class="err">  // Половина измененного изображения
  </span><span class="nl">width</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>

<span class="c1">// Грань пересекает изображения посередине</span>
<span class="nc">.cropper</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">background-color</span><span class="p">:</span> <span class="mh">#cbd5e0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">cursor</span><span class="p">:</span> <span class="n">ew-resize</span><span class="p">;</span>
<span class="err">  
  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
<span class="err">  </span><span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">left</span><span class="p">:</span> <span class="m">50%</span><span class="p">;</span>
<span class="err">  
  </span><span class="nl">width</span><span class="p">:</span> <span class="m">2px</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="m">100%</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <h4 id="section-23">Обработчики</h4>

      <p>Когда пользователь передвигает грань, мы рассчитываем насколько переместился курсор и, исходя из этого, — новое положение грани и ширину измененного изображения.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">cropper</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">drag-me</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">leftSide</span> <span class="o">=</span> <span class="nx">cropper</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>

<span class="c1">// Инициализируем координаты курсора</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Инициализируем ширину модифицированного изображения</span>
<span class="kd">let</span> <span class="nx">leftWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/* Обработчик события `mousedown`. Срабатывает,
когда пользователь перетаскивает грань */</span>
<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Текущие координаты курсора</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Текущая ширина модифицированного изображения</span>
<span class="err">  </span><span class="nx">leftWidth</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Устанавливаем слушатели на документ</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко передвинулся курсор</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="kd">let</span> <span class="nx">newLeftWidth</span> <span class="o">=</span>
<span class="err">    </span><span class="p">((</span><span class="nx">leftWidth</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
<span class="err">    </span><span class="nx">cropper</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
<span class="err">  </span><span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newLeftWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="err">  </span><span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">newLeftWidth</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>

<span class="err">  </span><span class="cm">/* Расчет ширины модифицированного изображения
  и позиции грани */</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">newLeftWidth</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="err">  </span><span class="nx">cropper</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">left</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">newLeftWidth</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="p">};</span>

<span class="c1">// Устанавливаем слушатель</span>
<span class="nx">cropper</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span>
<span class="p">);</span>
</code></pre></div>      </div>

      <p>Кроме всего прочего, мы должны следить за тем, чтобы в наших расчетах учитывались передвижения курсора только в рамках контейнера. Поэтому мы должны сравнивать <code class="language-plaintext highlighter-rouge">newLeftWidth</code> с 0 и 100 процентами ширины контейнера.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Предыдущий код...</span>

<span class="err">  </span><span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">max</span><span class="p">(</span><span class="nx">newLeftWidth</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
<span class="err">  </span><span class="nx">newLeftWidth</span> <span class="o">=</span> <span class="nb">Math</span><span class="p">.</span><span class="nx">min</span><span class="p">(</span><span class="nx">newLeftWidth</span><span class="p">,</span> <span class="mi">100</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Загрузка файла: по клику и при переходе на страницу
  </summary>
  <div class="accordion__body">
      <h4 id="section-24">Загрузка по клику</h4>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;a</span> <span class="na">href=</span><span class="s">"/path/to/file"</span> <span class="na">download</span><span class="nt">&gt;</span>Download<span class="nt">&lt;/a&gt;</span>
</code></pre></div>      </div>

      <h4 id="click">Загрузка при переходе на страницу — вызов события <code class="language-plaintext highlighter-rouge">click</code></h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Создаем ссылку</span>
<span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
<span class="c1">// &lt;a href="/path/to/real-name" download="my-name"&gt;</span>
<span class="nx">link</span><span class="p">.</span><span class="nx">download</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">my-name</span><span class="dl">'</span><span class="p">;</span>
<span class="nx">link</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">/path/to/real-name</span><span class="dl">'</span><span class="p">;</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>

<span class="c1">// Инициируем клик</span>
<span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>

<span class="c1">// Удаляем ссылку</span>
<span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
</code></pre></div>      </div>

      <h4 id="section-25">Загрузка сгенерированного содержания</h4>

      <p>Часто надо загрузить динамически создаваемое содержание: текст, изображение, JSON.</p>

      <p>Сгенерированное содержание (в примере — JSON), можно перевести в <a href="https://developer.mozilla.org/ru/docs/Web/API/Blob" target="_blank">объект Blob</a> и затем вызвать событие <code class="language-plaintext highlighter-rouge">click</code>, как описывалось выше.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Создаем Blob c JSON'ом</span>
<span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span> <span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Hello Word</span><span class="dl">'</span> <span class="p">});</span>
<span class="kd">const</span> <span class="nx">blob</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Blob</span><span class="p">([</span><span class="nx">data</span><span class="p">],</span> <span class="p">{</span>
<span class="err">  </span><span class="na">type</span><span class="p">:</span> <span class="dl">'</span><span class="s1">application/json</span><span class="dl">'</span>
<span class="p">});</span>

<span class="c1">// Преобразовываем blob в URL</span>
<span class="kd">const</span> <span class="nx">url</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">createObjectURL</span><span class="p">(</span><span class="nx">blob</span><span class="p">);</span>

<span class="c1">// Создаем ссылку, инициируем `click`, удаляем ссылку</span>
<span class="c1">// ...</span>

<span class="c1">// Дополнительно удаляем объект URL</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">URL</span><span class="p">.</span><span class="nx">revokeObjectURL</span><span class="p">(</span><span class="nx">url</span><span class="p">);</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Обмен данными с `iframe`
  </summary>
  <div class="accordion__body">
      <h4 id="iframe---">Передача данных из <code class="language-plaintext highlighter-rouge">iframe</code> наверх, родительскому окну</h4>

      <p>В этом примере в переменной <code class="language-plaintext highlighter-rouge">message</code> передаем строку.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>А если нужно передать объект, сначала записываем в формате JSON и конвертируем в строку методом <code class="language-plaintext highlighter-rouge">stringify</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="err">  </span><span class="na">message</span><span class="p">:</span> <span class="dl">'</span><span class="s1">Hello from iframe</span><span class="dl">'</span><span class="p">,</span>
<span class="err">  </span><span class="na">date</span><span class="p">:</span> <span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">(),</span>
<span class="p">});</span>

<span class="c1">// Вызов из `iframe`</span>
<span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>      </div>

      <h4 id="iframe-2">Передача данных в <code class="language-plaintext highlighter-rouge">iframe</code></h4>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Вызов из родительской страницы</span>
<span class="nx">myFrame</span><span class="p">.</span><span class="nx">contentWindow</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>      </div>

      <h4 id="section-26">Получение данных</h4>

      <p>Чтобы получить данные, в <code class="language-plaintext highlighter-rouge">iframe</code> или на родительской странице нужно добавить слушателя события <code class="language-plaintext highlighter-rouge">message</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем данные</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">;</span>

<span class="err">  </span><span class="cm">/* Если данные содержат десериализованный JSON,
  их нужно сериализовать — перевести из строки
  в объект */</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">decoded</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">data</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-27">Совет</h4>

      <p>Если обмен данными осуществляется с разными <code class="language-plaintext highlighter-rouge">iframe</code>, можно добавить свойство-«подпись».</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Передача данных из `iframe`</span>
<span class="kd">const</span> <span class="nx">message</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">stringify</span><span class="p">({</span>
<span class="err">  </span><span class="na">channel</span><span class="p">:</span> <span class="dl">'</span><span class="s1">FROM_FRAME_A</span><span class="dl">'</span><span class="p">,</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="p">});</span>

<span class="nb">window</span><span class="p">.</span><span class="nx">parent</span><span class="p">.</span><span class="nx">postMessage</span><span class="p">(</span><span class="nx">message</span><span class="p">,</span> <span class="dl">'</span><span class="s1">*</span><span class="dl">'</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>В получателе (в примере — родительская страница) теперь можно распознавать отправителей.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">message</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nx">parse</span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">data</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Откуда «дровишки»?</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">channel</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">channel</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Установить высоту iframe по содержанию
  </summary>
  <div class="accordion__body">
      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">frame</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">my-iframe</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">frame</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получим высоту содержания</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">height</span> <span class="o">=</span> <span class="nx">frame</span><span class="p">.</span><span class="nx">contentDocument</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">scrollHeight</span><span class="p">;</span>
<span class="err">  </span>
<span class="err">  </span><span class="c1">// Установим высоту iframe.my-iframe</span>
<span class="err">  </span><span class="nx">frame</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">height</span><span class="dl">'</span><span class="p">,</span> <span class="s2">`</span><span class="p">${</span><span class="nx">height</span><span class="p">}</span><span class="s2">px`</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Индикатор загрузки `iframe`
  </summary>
  <div class="accordion__body">
      <h4 id="section-28">Разметка и стили</h4>

      <p>Изначально <code class="language-plaintext highlighter-rouge">iframe</code> скрыто (<code class="language-plaintext highlighter-rouge">opacity: 0</code>). А индикатор выравнен по центру.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"container"</span><span class="nt">&gt;</span>
  <span class="c">&lt;!-- The loading indicator --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"loader"</span> <span class="na">id=</span><span class="s">"loader"</span><span class="nt">&gt;</span>Loading<span class="nt">&lt;/div&gt;</span>
  
  <span class="c">&lt;!-- The iframe --&gt;</span>
  <span class="nt">&lt;iframe</span> <span class="na">id=</span><span class="s">"frame"</span> <span class="na">style=</span><span class="s">"opacity: 0;"</span><span class="nt">&gt;&lt;/iframe&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.container</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
<span class="err">  </span><span class="nl">align-items</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="err">  </span><span class="nl">justify-content</span><span class="p">:</span> <span class="nb">center</span><span class="p">;</span>
<span class="err">  </span><span class="nl">width</span><span class="p">:</span> <span class="m">100vw</span><span class="p">;</span>
<span class="err">  </span><span class="nl">height</span><span class="p">:</span> <span class="m">100vh</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.loader</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">background</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--color-background-alt</span><span class="p">);</span>
<span class="err">  </span><span class="nl">box-shadow</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--layer-box-shadow-z3</span><span class="p">);</span>
<span class="err">  </span><span class="nl">border-radius</span><span class="p">:</span> <span class="n">var</span><span class="p">(</span><span class="n">--shape-border-radius-base</span><span class="p">);</span>
<span class="err">  </span><span class="nl">padding</span><span class="p">:</span> <span class="err">$</span><span class="n">size-line</span> <span class="err">$</span><span class="n">size-1p5</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <h4 id="load">Обработка события <code class="language-plaintext highlighter-rouge">load</code></h4>

      <p>Скроем индикатор, когда загрузка закончится.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">iframeEle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">loadingEle</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">loader</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">iframeEle</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">load</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Скрыть индикатор</span>
<span class="err">  </span><span class="nx">loadingEle</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Показать iframe</span>
<span class="err">  </span><span class="nx">iframeEle</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">opacity</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Сортировка таблицы
  </summary>
  <div class="accordion__body">
      <p>Разметка:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span> <span class="na">id=</span><span class="s">"sort-me"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/table&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-29">Сортировка строк</h4>

      <p>Сначала выберем все ячейки первой строки и установим на них слушатели события <code class="language-plaintext highlighter-rouge">click</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">sort-me</span><span class="dl">'</span><span class="p">);</span>

<span class="cm">/* Нам понадобиться методы `sort` и `map`, поэтому
создадим из набора элементов массив */</span>
<span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span>
<span class="err">  </span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">headers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">header</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">header</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Об этой функции — ниже</span>
<span class="err">    </span><span class="nx">sortColumn</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Функция <code class="language-plaintext highlighter-rouge">sortColumn</code> сортирует все строки таблицы по указанному индексу колонки. Для этого мы сделает вот что.</p>

      <ul>
        <li>Используем метод массива <code class="language-plaintext highlighter-rouge">sort()</code> для сортировки строк</li>
        <li>Затем удалим строки в исходном порядке.</li>
        <li>И добавим строки в новом порядке.</li>
      </ul>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">tableBody</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">tbody</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">tableBody</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">);</span>

<span class="kd">const</span> <span class="nx">sortColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Клонируем строки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">newRows</span> <span class="o">=</span> <span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">rows</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Сортируем строки по содержанию ячеек</span>
<span class="err">  </span><span class="nx">newRows</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">rowA</span><span class="p">,</span> <span class="nx">rowB</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">cellA</span>
<span class="err">      </span><span class="o">=</span> <span class="nx">rowA</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">cellB</span>
<span class="err">      </span><span class="o">=</span> <span class="nx">rowB</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>

<span class="err">    </span><span class="k">switch</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="k">case</span> <span class="nx">cellA</span> <span class="o">&gt;</span> <span class="na">cellB</span><span class="p">:</span>
<span class="err">        </span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="err">      </span><span class="k">case</span> <span class="nx">cellA</span> <span class="o">&lt;</span> <span class="na">cellB</span><span class="p">:</span>
<span class="err">        </span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="err">      </span><span class="k">case</span> <span class="nx">cellA</span> <span class="o">===</span> <span class="na">cellB</span><span class="p">:</span>
<span class="err">        </span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">});</span>

<span class="err">  </span><span class="c1">// Удаляем строки в исходном порядке</span>
<span class="err">  </span><span class="nx">rows</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">row</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">tableBody</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>

<span class="err">  </span><span class="c1">// Добавляем новые строки</span>
<span class="err">  </span><span class="nx">newRows</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">newRow</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">tableBody</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">newRow</span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Всё хорошо. Но метод массива <code class="language-plaintext highlighter-rouge">sort</code> пригоден только для сортировки строк.</p>

      <h4 id="section-30">Другие типы данных</h4>

      <p>Добавим <code class="language-plaintext highlighter-rouge">th</code> колонки пользовательский атрибут для маркировки типов данных</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;thead&gt;</span>
  <span class="nt">&lt;tr&gt;</span>
    <span class="nt">&lt;th</span> <span class="na">data-type=</span><span class="s">"number"</span><span class="nt">&gt;</span>No.<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>First name<span class="nt">&lt;/th&gt;</span>
    <span class="nt">&lt;th&gt;</span>Last name<span class="nt">&lt;/th&gt;</span>
  <span class="nt">&lt;/tr&gt;</span>
<span class="nt">&lt;/thead&gt;</span>
</code></pre></div>      </div>

      <p>Добавим функцию, которая конвертирует строку в другой тип данных.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">transform</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">content</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем тип данных колонки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">type</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">headers</span><span class="p">[</span><span class="nx">index</span><span class="p">].</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-type</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="k">switch</span> <span class="p">(</span><span class="nx">type</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="k">case</span> <span class="dl">'</span><span class="s1">number</span><span class="dl">'</span><span class="p">:</span>
<span class="err">      </span><span class="k">return</span> <span class="nb">parseFloat</span><span class="p">(</span><span class="nx">content</span><span class="p">);</span>
<span class="err">    </span><span class="k">case</span> <span class="dl">'</span><span class="s1">string</span><span class="dl">'</span><span class="p">:</span>
<span class="err">    </span><span class="na">default</span><span class="p">:</span>
<span class="err">      </span><span class="k">return</span> <span class="nx">content</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>В примере конвертируется только числа, но может добавить <code class="language-plaintext highlighter-rouge">case</code> и для других типов: <code class="language-plaintext highlighter-rouge">date</code> etc.</p>

      <p>Теперь немного улучшим функцию <code class="language-plaintext highlighter-rouge">sortColumn</code>, заменив в сравнении необработанные данные данными, полученными из функции <code class="language-plaintext highlighter-rouge">transform</code>.-index</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">newRows</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">rowA</span><span class="p">,</span> <span class="nx">rowB</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">cellA</span>
<span class="err">    </span><span class="o">=</span> <span class="nx">rowA</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">cellB</span>
<span class="err">    </span><span class="o">=</span> <span class="nx">rowB</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Преобразование типов</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cellA</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cellB</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// AСравнение</span>
<span class="err">  </span><span class="k">switch</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="k">case</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="na">b</span><span class="p">:</span>
<span class="err">      </span><span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
<span class="err">    </span><span class="k">case</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="na">b</span><span class="p">:</span>
<span class="err">      </span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
<span class="err">    </span><span class="k">case</span> <span class="nx">a</span> <span class="o">===</span> <span class="na">b</span><span class="p">:</span>
<span class="err">      </span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <h4 id="section-31">Обратный порядок</h4>

      <p>Если пользователь кликает по ячейке <code class="language-plaintext highlighter-rouge">th</code> повторно, порядок сортировки должен меняться. Для этого следует создать специальный массив.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">directions</span> <span class="o">=</span>
<span class="err">  </span><span class="nb">Array</span><span class="p">.</span><span class="k">from</span><span class="p">(</span><span class="nx">headers</span><span class="p">).</span><span class="nx">map</span><span class="p">((</span><span class="nx">header</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="k">return</span> <span class="dl">''</span><span class="p">;</span>
<span class="err">  </span><span class="p">});</span>
</code></pre></div>      </div>

      <p>В массиве <code class="language-plaintext highlighter-rouge">directions</code> будем сохранять значения <code class="language-plaintext highlighter-rouge">asc</code> или <code class="language-plaintext highlighter-rouge">desc</code> для каждой колонки. Соответственно, обновим функцию <code class="language-plaintext highlighter-rouge">sortColumn()</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">sortColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Текущий порядок сортировки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">direction</span> <span class="o">=</span> <span class="nx">directions</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">||</span> <span class="dl">'</span><span class="s1">asc</span><span class="dl">'</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Коэффициент сортировки, основанный на порядке</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">multiplier</span> <span class="o">=</span> <span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">asc</span><span class="dl">'</span> <span class="p">?</span> <span class="mi">1</span> <span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// ...</span>

<span class="err">  </span><span class="nx">newRows</span><span class="p">.</span><span class="nx">sort</span><span class="p">((</span><span class="nx">rowA</span><span class="p">,</span> <span class="nx">rowB</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">cellA</span>
<span class="err">      </span><span class="o">=</span> <span class="nx">rowA</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">cellB</span>
<span class="err">      </span><span class="o">=</span> <span class="nx">rowB</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">td</span><span class="dl">'</span><span class="p">)[</span><span class="nx">index</span><span class="p">].</span><span class="nx">innerHTML</span><span class="p">;</span>

<span class="err">    </span><span class="kd">const</span> <span class="nx">a</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cellA</span><span class="p">);</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">b</span> <span class="o">=</span> <span class="nx">transform</span><span class="p">(</span><span class="nx">index</span><span class="p">,</span> <span class="nx">cellB</span><span class="p">);</span>

<span class="err">    </span><span class="k">switch</span> <span class="p">(</span><span class="kc">true</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="k">case</span> <span class="nx">a</span> <span class="o">&gt;</span> <span class="na">b</span><span class="p">:</span>
<span class="err">        </span><span class="k">return</span> <span class="mi">1</span> <span class="o">*</span> <span class="nx">multiplier</span><span class="p">;</span>
<span class="err">      </span><span class="k">case</span> <span class="nx">a</span> <span class="o">&lt;</span> <span class="na">b</span><span class="p">:</span>
<span class="err">        </span><span class="k">return</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="nx">multiplier</span><span class="p">;</span>
<span class="err">      </span><span class="k">case</span> <span class="nx">a</span> <span class="o">===</span> <span class="na">b</span><span class="p">:</span>
<span class="err">        </span><span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">});</span>

<span class="err">  </span><span class="c1">// ...</span>

<span class="err">  </span><span class="c1">// Меняем порядок сортировки</span>
<span class="err">  </span><span class="nx">directions</span><span class="p">[</span><span class="nx">index</span><span class="p">]</span> <span class="o">=</span>
<span class="err">    </span><span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">asc</span><span class="dl">'</span> <span class="p">?</span> <span class="dl">'</span><span class="s1">desc</span><span class="dl">'</span> <span class="p">:</span> <span class="dl">'</span><span class="s1">asc</span><span class="dl">'</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/sort-a-table-by-clicking-its-headers/index.html" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Показать или скрыть колонки таблицы
  </summary>
  <div class="accordion__body">
      <p>Каркас разметки:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"table"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"menu"</span><span class="nt">&gt;&lt;/ul&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-32">Меню</h4>

      <p>Меню содержит чекбоксы для скрытия каждой из колонок.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;ul</span> <span class="na">id=</span><span class="s">"menu"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;li&gt;</span>
    <span class="c">&lt;!-- Чекбокс первой колонки --&gt;</span>
    <span class="nt">&lt;label&gt;</span>
      <span class="nt">&lt;input</span> <span class="na">type=</span><span class="s">"checkbox"</span><span class="nt">&gt;</span>Название столбца
    <span class="nt">&lt;/label&gt;</span>
    <span class="c">&lt;!-- Остальные колонки ... --&gt;</span>
  <span class="nt">&lt;/li&gt;</span>
<span class="nt">&lt;/ul&gt;</span>
</code></pre></div>      </div>

      <p>Чтобы добавить в меню все нужные чекбоксы, переберем ячейки первой строки таблицы.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">menu</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">menu</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">table</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">headers</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">headers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">th</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Создаем чекбокс для каждой колонки</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">li</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">li</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">label</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">label</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">checkbox</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">input</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">checkbox</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">type</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">checkbox</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Надпись в `label` соответствует названию столбца</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">text</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createTextNode</span><span class="p">(</span><span class="nx">th</span><span class="p">.</span><span class="nx">textContent</span><span class="p">);</span>

<span class="err">  </span><span class="nx">label</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">checkbox</span><span class="p">);</span>
<span class="err">  </span><span class="nx">label</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">text</span><span class="p">);</span>

<span class="err">  </span><span class="nx">li</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">label</span><span class="p">);</span>
<span class="err">  </span><span class="nx">menu</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">li</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Для переключения видимости будем обрабатывать событие <code class="language-plaintext highlighter-rouge">change</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">headers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">th</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Создаем чекбокс для каждой колонки</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="c1">// Обрабатываем событие</span>
<span class="err">  </span><span class="nx">checkbox</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">change</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">checked</span>
<span class="err">      </span><span class="p">?</span> <span class="nx">showColumn</span><span class="p">(</span><span class="nx">index</span><span class="p">)</span>
<span class="err">      </span><span class="p">:</span> <span class="nx">hideColumn</span><span class="p">(</span><span class="nx">index</span><span class="p">);</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>К функциям <code class="language-plaintext highlighter-rouge">showColumn</code> и <code class="language-plaintext highlighter-rouge">hideColumn</code> вернемся чуть позже.</p>

      <h4 id="section-33">Как показать/скрыть меню</h4>

      <ul>
        <li>Меню должно открываться, когда пользователь кликает на первую строку таблицы.</li>
        <li>Меню должно скрываться, когда пользователь кликает за его пределами.</li>
      </ul>

      <p>Контекстному меню посвящен <a href="#topic-context-menu">собственный раздел</a>. А в данном случае оно будет реализовано так.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">thead</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">thead</span><span class="dl">'</span><span class="p">);</span>

<span class="cm">/* Обработаем событие `contextmenu` на первой
строке таблицы */</span>
<span class="nx">thead</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">contextmenu</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">e</span><span class="p">.</span><span class="nx">preventDefault</span><span class="p">();</span>

<span class="err">  </span><span class="c1">// Покажем меню</span>
<span class="err">  </span><span class="c1">// ...</span>

<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="nx">documentClickHandler</span><span class="p">);</span>
<span class="p">});</span>

<span class="c1">// Скроем меню на клике за его границами</span>
<span class="kd">const</span> <span class="nx">documentClickHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="section-34">Переключаем колонки</h4>

      <p>Кликая определенный чекбокс в меню, мы должны скрывать и показывать колонки по соответствующему индексу в <code class="language-plaintext highlighter-rouge">NodeList</code>.</p>

      <p>Для того, чтобы выбрать все ячейки в колонке, мы каждой добавим атрибут <code class="language-plaintext highlighter-rouge">data-column-index</code> с общим значением.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Получаем количество колонок</span>
<span class="kd">const</span> <span class="nx">numColumns</span> <span class="o">=</span> <span class="nx">headers</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span>

<span class="cm">/* Чтобы позже использовать метод `filter`,
сохраним набор элементов, как массив */</span>
<span class="kd">const</span> <span class="nx">cells</span> <span class="o">=</span>
<span class="err">  </span><span class="p">[].</span><span class="nx">slice</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th, td</span><span class="dl">'</span><span class="p">));</span>

<span class="nx">cells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">cell</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">data-column-index</span><span class="dl">'</span><span class="p">,</span> <span class="nx">index</span> <span class="o">%</span> <span class="nx">numColumns</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Прячем колонки с определенным значением <code class="language-plaintext highlighter-rouge">data-column-index</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hideColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">cells</span>
<span class="err">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="k">return</span> <span class="p">(</span>
<span class="err">        </span><span class="nx">cell</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-column-index</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span>
<span class="err">        </span><span class="s2">`</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span>
<span class="err">      </span><span class="p">);</span>
<span class="err">    </span><span class="p">})</span>
<span class="err">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">cell</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err">    </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Показываем колонки.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">showColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">cells</span>
<span class="err">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="k">return</span> <span class="p">(</span>
<span class="err">        </span><span class="nx">cell</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-column-index</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span>
<span class="err">        </span><span class="s2">`</span><span class="p">${</span><span class="nx">index</span><span class="p">}</span><span class="s2">`</span>
<span class="err">      </span><span class="p">);</span>
<span class="err">    </span><span class="p">})</span>
<span class="err">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">cell</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">''</span><span class="p">;</span>
<span class="err">    </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="section-35">Не позволяем скрыть последнюю оставшуюся колонку</h4>

      <p>Добавим чекбоксам в меню тот же <code class="language-plaintext highlighter-rouge">data</code>-атрибут, что и ячейкам.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">headers</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">th</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Создаем чекбокс для каждой колонки</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="nx">checkbox</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-column-index</span><span class="dl">'</span><span class="p">,</span> <span class="nx">index</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>

      <p>Когда колонка скрыта, мы добавляем еще один пользовательский атрибут, для того чтобы поменить скрытую колонку.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hideColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">cells</span>
<span class="err">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// ...</span>
<span class="err">    </span><span class="p">})</span>
<span class="err">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// ...</span>
<span class="err">      </span><span class="nx">cell</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-shown</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">false</span><span class="dl">'</span><span class="p">);</span>
<span class="err">    </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Подсчитав, сколько колонок уже скрыто, мы можем блокировать чекбокс, связанной с единственной оставшейся.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">hideColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Сколько колонок уже скрыто?</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">numHiddenCols</span> <span class="o">=</span> <span class="p">[...</span><span class="nx">headers</span><span class="p">].</span><span class="nx">filter</span><span class="p">((</span><span class="nx">th</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="k">return</span> <span class="nx">th</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-shown</span><span class="dl">'</span><span class="p">)</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">false</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="p">}).</span><span class="nx">length</span><span class="p">;</span>

<span class="err">  </span><span class="k">if</span> <span class="p">(</span><span class="nx">numHiddenCols</span> <span class="o">===</span> <span class="nx">numColumns</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="cm">/* Когда остается одна видимая колонка,
    блокируем соответствующий чекбокс */</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">shownColumnIndex</span> <span class="o">=</span> <span class="nx">thead</span>
<span class="err">      </span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span><span class="dl">'</span><span class="s1">[data-shown="true"]</span><span class="dl">'</span><span class="p">)</span>
<span class="err">      </span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-column-index</span><span class="dl">'</span><span class="p">);</span>

<span class="err">    </span><span class="kd">const</span> <span class="nx">checkbox</span> <span class="o">=</span> <span class="nx">menu</span><span class="p">.</span><span class="nx">querySelector</span><span class="p">(</span>
<span class="err">      </span><span class="s2">`
        [type="checkbox"]
        [data-column-index="</span><span class="p">${</span><span class="nx">shownColumnIndex</span><span class="p">}</span><span class="s2">"]
      `</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nx">checkbox</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">disabled</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="p">}</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Меняем атрибут <code class="language-plaintext highlighter-rouge">data-shown</code>, когда колонка видна.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nx">cells</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">,</span> <span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">cell</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-shown</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>

<span class="kd">const</span> <span class="nx">showColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">index</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">cells</span>
<span class="err">    </span><span class="p">.</span><span class="nx">filter</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// ...</span>
<span class="err">    </span><span class="p">})</span>
<span class="err">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// ...</span>
<span class="err">      </span><span class="nx">cell</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-shown</span><span class="dl">'</span><span class="p">,</span> <span class="dl">'</span><span class="s1">true</span><span class="dl">'</span><span class="p">);</span>
<span class="err">    </span><span class="p">});</span>

<span class="err">  </span><span class="nx">menu</span>
<span class="err">    </span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">[type="checkbox"][disabled]</span><span class="dl">'</span><span class="p">)</span>
<span class="err">    </span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">checkbox</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="nx">checkbox</span><span class="p">.</span><span class="nx">removeAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">disabled</span><span class="dl">'</span><span class="p">);</span>
<span class="err">    </span><span class="p">});</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/show-or-hide-table-columns/index.html" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Изменение ширины колонки в таблице
  </summary>
  <div class="accordion__body">
      <p>Разметка:</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table</span> <span class="na">class=</span><span class="s">"table"</span> <span class="na">id=</span><span class="s">"resize-me"</span><span class="nt">&gt;</span>
  ...
<span class="nt">&lt;/table&gt;</span>
</code></pre></div>      </div>

      <h4 id="section-36">«Ручки»</h4>

      <p>Для каждой колонки создадим «ручки» — абсолютно позиционированные относительно ячейки первой строки элементы, которые будет перемещать пользователь. Они нужны потому, что края колонок не являются DOM-элементами.</p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.table</span> <span class="nt">th</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">relative</span><span class="p">;</span>
<span class="p">}</span>

<span class="nc">.resizer</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">cursor</span><span class="p">:</span> <span class="n">col-resize</span><span class="p">;</span>
<span class="err">  </span><span class="nl">position</span><span class="p">:</span> <span class="nb">absolute</span><span class="p">;</span>
<span class="err">  </span><span class="nl">top</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="nl">right</span><span class="p">:</span> <span class="m">0</span><span class="p">;</span>
<span class="err">  </span><span class="py">user-select</span><span class="p">:</span> <span class="nb">none</span><span class="p">;</span>
<span class="err">  </span><span class="nl">width</span><span class="p">:</span> <span class="m">5px</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>Создадим «ручки» в JS.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">resize-me</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">cols</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">cols</span><span class="p">.</span><span class="nx">forEach</span><span class="p">((</span><span class="nx">col</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">resizer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">div</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">resizer</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Сделаем высоту ручки равной высоте таблицы</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">table</span><span class="p">.</span><span class="nx">offsetHeight</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Прикрепим ручку к колонке</span>
<span class="err">  </span><span class="nx">col</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">resizer</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// До этой функции скоро доберемся</span>
<span class="err">  </span><span class="nx">createResizableColumn</span><span class="p">(</span><span class="nx">col</span><span class="p">,</span> <span class="nx">resizer</span><span class="p">);</span>
<span class="p">});</span>

</code></pre></div>      </div>

      <h4 id="section-37">Обработчики событий</h4>

      <p>Напишем функцию <code class="language-plaintext highlighter-rouge">createResizableColumn</code> с двумя параметрами:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">col</code> — ячейка первой строки таблицы</li>
        <li><code class="language-plaintext highlighter-rouge">resizer</code> — «ручка»</li>
      </ul>

      <p>In order to allow user to resize <code class="language-plaintext highlighter-rouge">col</code>, we have to handle three events:</p>

      <ul>
        <li><code class="language-plaintext highlighter-rouge">mousedown</code> — добавляем обработчик на первые ячейки колонок для отслеживания позиции курсора.</li>
        <li><code class="language-plaintext highlighter-rouge">mousemove</code> — добавляем обработчик на документ для рассчета дальности перемещения курсора и соответствующего изменения ширины колонки.</li>
        <li><code class="language-plaintext highlighter-rouge">mouseup</code> — добавляем обработчик на документ, чтобы по окончанию перетягивания удалить обработчики, установленные ранее.</li>
      </ul>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">createResizableColumn</span> <span class="o">=</span> <span class="p">(</span><span class="nx">col</span><span class="p">,</span> <span class="nx">resizer</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Текущая позиция мыши</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="err">  </span><span class="kd">let</span> <span class="nx">w</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Определяем, как далеко курсор переместился</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">;</span>

<span class="err">    </span><span class="c1">// Соответственно, меняем ширину колонки</span>
<span class="err">    </span><span class="nx">col</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">w</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">}</span><span class="s2">px`</span><span class="p">;</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="cm">/* Удаляем слушатели и обработчики, как только
  пользователь заканчивает перетаскивание ручки */</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="c1">// Текущая позиция курсора</span>
<span class="err">    </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>

<span class="err">    </span><span class="c1">// Рассчитываем текущую ширину колонки</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">styles</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getComputedStyle</span><span class="p">(</span><span class="nx">col</span><span class="p">);</span>
<span class="err">    </span><span class="nx">w</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">styles</span><span class="p">.</span><span class="nx">width</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>

<span class="err">    </span><span class="c1">// Устанавливаем слушатели на документ</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">      </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">    </span><span class="p">);</span>
<span class="err">  </span><span class="p">};</span>

<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="section-38">Выделение ручки</h4>

      <p>Окрасим ручки в синий на <code class="language-plaintext highlighter-rouge">:hover</code>.</p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.resizer</span><span class="nd">:hover</span><span class="o">,</span>
<span class="nc">.resizing</span> <span class="p">{</span>
<span class="err">  </span><span class="nl">border-right</span><span class="p">:</span> <span class="m">2px</span> <span class="nb">solid</span> <span class="no">blue</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <p>Добавим ручкам класс <code class="language-plaintext highlighter-rouge">is-resizing</code> — на то время, пока пользователь их перетягивает.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">add</span><span class="p">(</span><span class="dl">'</span><span class="s1">is-resizing</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">classList</span><span class="p">.</span><span class="nx">remove</span><span class="p">(</span><span class="dl">'</span><span class="s1">is-resizing</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/resize-columns-of-a-table/index.html" target="_blank">HTML DOM</a>.</p>

    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Экспорт HTML-таблицы в CSV
  </summary>
  <div class="accordion__body">
      <h4 id="section-39">Экспорт ячеек</h4>

      <p>В примере мы переведем данные таблицы <code class="language-plaintext highlighter-rouge">exportMe</code> в CSV по нажатию кнопки <code class="language-plaintext highlighter-rouge">export</code>.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;table</span> <span class="na">id=</span><span class="s">"exportMe"</span> <span class="na">class=</span><span class="s">"table"</span><span class="nt">&gt;</span><span class="c">&lt;!--...--&gt;</span><span class="nt">&lt;/table&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"export"</span><span class="nt">&gt;</span>Export<span class="nt">&lt;/button&gt;</span>
</code></pre></div>      </div>

      <p>Функция <code class="language-plaintext highlighter-rouge">toCsv</code> переводит ячейки в формат CSV. Получаем строки, перебираем каждую: извлекаем содержимое ячеек, записываем через запятую; каждую <code class="language-plaintext highlighter-rouge">tr</code> записываем на новой строке.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">toCsv</span> <span class="o">=</span> <span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Получаем все строки таблицы</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">tr</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Перебираем строки, собираем и возвращаем CSV</span>
<span class="err">  </span><span class="k">return</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">    </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">rows</span><span class="p">)</span>
<span class="err">    </span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">row</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// Получаем все ячейки</span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">cells</span> <span class="o">=</span> <span class="nx">row</span><span class="p">.</span><span class="nx">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">th,td</span><span class="dl">'</span><span class="p">);</span>
<span class="err">      </span><span class="k">return</span> <span class="p">[].</span><span class="nx">slice</span>
<span class="err">        </span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="nx">cells</span><span class="p">)</span>
<span class="err">        </span><span class="p">.</span><span class="nx">map</span><span class="p">((</span><span class="nx">cell</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">          </span><span class="k">return</span> <span class="nx">cell</span><span class="p">.</span><span class="nx">textContent</span><span class="p">;</span>
<span class="err">        </span><span class="p">})</span>
<span class="err">        </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="s1">,</span><span class="dl">'</span><span class="p">);</span>
<span class="err">    </span><span class="p">})</span>
<span class="err">    </span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="dl">'</span><span class="se">\n</span><span class="dl">'</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="csv">Загружаем CSV</h4>

      <p>Функция <code class="language-plaintext highlighter-rouge">download</code> создает временную невидимую ссылку скачивания. Добавляет в атрибут <code class="language-plaintext highlighter-rouge">href</code> CSV, как Data URL. Инициирует событие <code class="language-plaintext highlighter-rouge">click</code>, а затем удаляет временную ссылку.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">download</span> <span class="o">=</span> <span class="p">(</span><span class="nx">text</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">link</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createElement</span><span class="p">(</span><span class="dl">'</span><span class="s1">a</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">href</span><span class="dl">'</span><span class="p">,</span>
<span class="err">    </span><span class="s2">`data:text/csv;
     charset=utf-8,</span><span class="p">${</span><span class="nb">encodeURIComponent</span><span class="p">(</span><span class="nx">text</span><span class="p">)}</span><span class="s2">`</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nx">link</span><span class="p">.</span><span class="nx">setAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">download</span><span class="dl">'</span><span class="p">,</span> <span class="nx">fileName</span><span class="p">);</span>

<span class="err">  </span><span class="nx">link</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">appendChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>

<span class="err">  </span><span class="nx">link</span><span class="p">.</span><span class="nx">click</span><span class="p">();</span>

<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">removeChild</span><span class="p">(</span><span class="nx">link</span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Устанавливаем на кнопку слушатель с обработчиком, последовательно вызывающим функции <code class="language-plaintext highlighter-rouge">toCsv</code> и <code class="language-plaintext highlighter-rouge">download</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">table</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">exportMe</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">exportBtn</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">export</span><span class="dl">'</span><span class="p">);</span>

<span class="nx">exportBtn</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Экспорт в CSV</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">csv</span> <span class="o">=</span> <span class="nx">toCsv</span><span class="p">(</span><span class="nx">table</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Скачивание CSV</span>
<span class="err">  </span><span class="nx">download</span><span class="p">(</span><span class="nx">csv</span><span class="p">,</span> <span class="dl">'</span><span class="s1">download.csv</span><span class="dl">'</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
</section>

<section>
  <h2>Редактирование</h2><details class="accordion">
  <summary class="accordion__header">
    Масштабируемое разделенное представление (split view)
  </summary>
  <div class="accordion__body">
      <p>Исходная разметка.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"display: flex"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"left"</span><span class="nt">&gt;</span>Left<span class="nt">&lt;/div&gt;</span>

  <span class="c">&lt;!-- The resizer --&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"resizer"</span> <span class="na">id=</span><span class="s">"dragMe"</span><span class="nt">&gt;&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"right"</span><span class="nt">&gt;</span>Right<span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <h4 id="split-">Обновление ширины честей split-представления</h4>

      <p>О том, как делать перетаскиваемый элемент, <a href="#topic-draggable-base">см. здесь</a>.</p>

      <p>В нашем случае ручка масштабирования будет двигаться только по горизонтали. Сначала нам надо получить позицию мыши и ширину левой части split-представления до масштабирования.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">resizer</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragMe</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">leftSide</span> <span class="o">=</span> <span class="nx">resizer</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">rightSide</span> <span class="o">=</span> <span class="nx">resizer</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span>

<span class="c1">// Позиция мыши</span>
<span class="kd">let</span> <span class="nx">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">// Ширина левой части</span>
<span class="kd">let</span> <span class="nx">leftWidth</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="cm">/** Обработка перетягивания мышью */</span>
<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Текущая позиция мыши</span>
<span class="err">  </span><span class="nx">x</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span><span class="p">;</span>
<span class="err">  </span><span class="nx">y</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span><span class="p">;</span>

<span class="err">  </span><span class="nx">leftWidth</span> <span class="o">=</span> <span class="nx">leftSide</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// Добавляем вложенные обработчики</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span><span class="p">);</span>
<span class="p">};</span>

<span class="c1">// Назначаем первый обработчик</span>
<span class="nx">resizer</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseDownHandler</span><span class="p">);</span>
</code></pre></div>      </div>

      <p>Если вернуться к разметке, обнаружим, что левая и правая часть представления являются предыдущим и следующим «соседями» ручки перетаскивания. Следовательно, выбираем их вот таким образом:</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">leftSide</span> <span class="o">=</span> <span class="nx">resizer</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>
<span class="kd">const</span> <span class="nx">rightSide</span> <span class="o">=</span> <span class="nx">resizer</span><span class="p">.</span><span class="nx">nextElementSibling</span><span class="p">;</span>
</code></pre></div>      </div>

      <p>Далее. Когда пользователь двигает мышью, мы определяем — как далеко — и, соответственно, обновляем ширину левой части представления.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// Как далеко сместилась мышь</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dx</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientX</span> <span class="o">-</span> <span class="nx">x</span><span class="p">;</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">dy</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">clientY</span> <span class="o">-</span> <span class="nx">y</span><span class="p">;</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">newLeftWidth</span> <span class="o">=</span>
<span class="err">    </span><span class="p">((</span><span class="nx">leftWidth</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
<span class="err">    </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">newLeftWidth</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Меняя ширину левой части представления, устанавливаем новое значение в процентах (от родительского элемента). Устанавливаем для правой части CSS-свойство <code class="language-plaintext highlighter-rouge">flex: 1 1 0</code> и она будет занимать всё оставшееся место — не нужно рассчитывать ширину в JS.</p>

      <div class="language-css highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nc">.right</span> <span class="p">{</span> <span class="nl">flex</span><span class="p">:</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span><span class="p">;}</span>
</code></pre></div>      </div>

      <h4 id="section-40">Исправляем мигание курсора</h4>

      <p>Когда пользователь перетаскивает ручку, мы должны поменять курсор.</p>

      <p>Но если мы изменим его только у ручки, то обнаружим, что он при перетягивании постоянно меняется: то нужный, то обычная стрелка. Это происходит потому, что под мышь попадают и другие элементы, а не только <code class="language-plaintext highlighter-rouge">resizer</code>.</p>

      <p>Чтобы исправить «баг», следует на момент перетягивания поменять курсор не только для ручки, но и для всего документа.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">// ...</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">col-resize</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">col-resize</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Также на момент перетягивания нужно предотвратить срабатывание событий и выделение текста в обоих частях split-представления. Для этого используем CSS-свойства <code class="language-plaintext highlighter-rouge">user-select</code> и <code class="language-plaintext highlighter-rouge">pointer-events</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="c1">// ...</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">userSelect</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">pointerEvents</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span>
<span class="err">  </span><span class="nx">rightSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">userSelect</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">rightSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">pointerEvents</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">none</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Стили будут удалены сразу после окончания перетягивания.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseUpHandler</span> <span class="o">=</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">cursor</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">cursor</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">user-select</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">leftSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">pointer-events</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="nx">rightSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">user-select</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="nx">rightSide</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">removeProperty</span><span class="p">(</span><span class="dl">'</span><span class="s1">pointer-events</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="c1">// Удаляем обработчики</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mousemove</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseMoveHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">removeEventListener</span><span class="p">(</span>
<span class="err">    </span><span class="dl">'</span><span class="s1">mouseup</span><span class="dl">'</span><span class="p">,</span> <span class="nx">mouseUpHandler</span>
<span class="err">  </span><span class="p">);</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="section-41">Перетягивание по вертикали</h4>

      <p>Вместо того, чтобы обновлять значение ширины левой части представления, будем обновлять высоту верхней части.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">prevSibling</span> <span class="o">=</span> <span class="nx">resizer</span><span class="p">.</span><span class="nx">previousElementSibling</span><span class="p">;</span>
<span class="kd">let</span> <span class="nx">prevSiblingHeight</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="kd">const</span> <span class="nx">mouseDownHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">rect</span> <span class="o">=</span> <span class="nx">prevSibling</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">();</span>
<span class="err">  </span><span class="nx">prevSiblingHeight</span> <span class="o">=</span> <span class="nx">rect</span><span class="p">.</span><span class="nx">height</span><span class="p">;</span>
<span class="p">};</span>

<span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">h</span> <span class="o">=</span>
<span class="err">    </span><span class="p">((</span><span class="nx">prevSiblingHeight</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
<span class="err">    </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">;</span>
<span class="err">  </span><span class="nx">prevSibling</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">h</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>Также поменяем курсор на <code class="language-plaintext highlighter-rouge">row-resize</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="c1">//...</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">row-resize</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">row-resize</span><span class="dl">'</span><span class="p">;</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <h4 id="split--1">Вложенные split-представления</h4>

      <p>Допустим, что нам нужно добавить в правую часть горизонтального split-представления вертикальное — как в VSCode, если выбрать View ➜ Editor Layout ➜ Two Rows.</p>

      <p>У нас будет две ручки перетягивания. Чтобы выбирать одну из них, добавим <code class="language-plaintext highlighter-rouge">data</code>-атрибуты.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;style&gt;</span>
<span class="err">  </span><span class="nc">.right</span> <span class="p">{</span>
<span class="err">    </span><span class="nl">display</span><span class="p">:</span> <span class="n">flex</span><span class="p">;</span>
<span class="err">    </span><span class="nl">flex</span><span class="p">:</span> <span class="m">1</span> <span class="m">1</span> <span class="m">0</span><span class="p">;</span>
<span class="err">    </span><span class="nl">flex-direction</span><span class="p">:</span> <span class="n">column</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>
<span class="nt">&lt;/style&gt;</span>

<span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"display: flex"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"left"</span><span class="nt">&gt;</span>Left<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"resizer"</span> <span class="na">data-direction=</span><span class="s">"horizontal"</span><span class="nt">&gt;&lt;/div&gt;</span>

  <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"right"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;div&gt;</span>Top<span class="nt">&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">class=</span><span class="s">"resizer"</span> <span class="na">data-direction=</span><span class="s">"vertical"</span><span class="nt">&gt;&lt;/div&gt;</span>
    <span class="nt">&lt;div</span> <span class="na">style=</span><span class="s">"flex: 1 1 0%"</span><span class="nt">&gt;</span>Bottom<span class="nt">&lt;/div&gt;</span>
  <span class="nt">&lt;/div&gt;</span>
<span class="nt">&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Теперь мы можем получать направление перетягивания.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">direction</span> <span class="o">=</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-direction</span><span class="dl">'</span><span class="p">)</span> <span class="o">||</span>
<span class="err">  </span><span class="dl">'</span><span class="s1">horizontal</span><span class="dl">'</span><span class="p">;</span>
</code></pre></div>      </div>

      <p>The logic of setting the width or height of previous sibling depends on the direction:</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">mouseMoveHandler</span> <span class="o">=</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="k">switch</span> <span class="p">(</span><span class="nx">direction</span><span class="p">)</span> <span class="p">{</span>
<span class="err">    </span><span class="k">case</span> <span class="dl">'</span><span class="s1">vertical</span><span class="dl">'</span><span class="p">:</span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">h</span> <span class="o">=</span>
<span class="err">        </span><span class="p">((</span><span class="nx">prevSiblingHeight</span> <span class="o">+</span> <span class="nx">dy</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
<span class="err">        </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">height</span><span class="p">;</span>
<span class="err">      </span><span class="nx">prevSibling</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">h</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="err">      </span><span class="k">break</span><span class="p">;</span>
<span class="err">    </span><span class="k">case</span> <span class="dl">'</span><span class="s1">horizontal</span><span class="dl">'</span><span class="p">:</span>
<span class="err">    </span><span class="na">default</span><span class="p">:</span>
<span class="err">      </span><span class="kd">const</span> <span class="nx">w</span> <span class="o">=</span>
<span class="err">        </span><span class="p">((</span><span class="nx">prevSiblingWidth</span> <span class="o">+</span> <span class="nx">dx</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span><span class="p">)</span> <span class="o">/</span>
<span class="err">        </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">parentNode</span><span class="p">.</span><span class="nx">getBoundingClientRect</span><span class="p">().</span><span class="nx">width</span><span class="p">;</span>
<span class="err">      </span><span class="nx">prevSibling</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="s2">`</span><span class="p">${</span><span class="nx">w</span><span class="p">}</span><span class="s2">%`</span><span class="p">;</span>
<span class="err">      </span><span class="k">break</span><span class="p">;</span>
<span class="err">  </span><span class="p">}</span>

<span class="err">  </span><span class="kd">const</span> <span class="nx">cursor</span> <span class="o">=</span> <span class="nx">direction</span> <span class="o">===</span> <span class="dl">'</span><span class="s1">horizontal</span><span class="dl">'</span>
<span class="err">    </span><span class="p">?</span> <span class="dl">'</span><span class="s1">col-resize</span><span class="dl">'</span>
<span class="err">    </span><span class="p">:</span> <span class="dl">'</span><span class="s1">row-resize</span><span class="dl">'</span><span class="p">;</span>
<span class="err">  </span><span class="nx">resizer</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="nx">cursor</span><span class="p">;</span>
<span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">cursor</span> <span class="o">=</span> <span class="nx">cursor</span><span class="p">;</span>

<span class="err">  </span><span class="c1">// ...</span>
<span class="p">};</span>
</code></pre></div>      </div>

      <p>См. демо на <a href="https://htmldom.dev/demo/make-a-draggable-element/" target="_blank">HTML DOM</a>.</p>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    «Заглушка» (placeholder) для редактируемого элемента, не `input`'а
  </summary>
  <div class="accordion__body">
      <p>Редактируемый элемент не обязательно должен быть полем ввода. Это может быть <code class="language-plaintext highlighter-rouge">div[contenteditable]</code>, а атрибута <code class="language-plaintext highlighter-rouge">placeholder</code> у <code class="language-plaintext highlighter-rouge">div</code>‘ов нет.</p>

      <h4 id="data----empty">1. Делаем с помощью <code class="language-plaintext highlighter-rouge">data</code>-атрибута и псевдокласса <code class="language-plaintext highlighter-rouge">:empty</code></h4>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;div</span>
<span class="err">  </span><span class="na">class=</span><span class="s">"is-editable"</span>
<span class="err">  </span><span class="na">id=</span><span class="s">"edit-me"</span>
<span class="err">  </span><span class="na">contenteditable</span>
<span class="err">  </span><span class="na">data-placeholder=</span><span class="s">"Edit me"</span>
<span class="nt">&gt;&lt;/div&gt;</span>
</code></pre></div>      </div>

      <p>Значение <code class="language-plaintext highlighter-rouge">data-placeholder</code> показываем, если элемент пустой.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">.</span><span class="nx">is</span><span class="o">-</span><span class="nx">editable</span><span class="p">:</span><span class="nx">empty</span><span class="p">:</span><span class="nx">before</span> <span class="p">{</span>
<span class="err">  </span><span class="nx">content</span><span class="p">:</span> <span class="nx">attr</span><span class="p">(</span><span class="nx">data</span><span class="o">-</span><span class="nx">placeholder</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div>      </div>

      <h4 id="section-42">2. С помощью обработчиков событий</h4>

      <p>Тот же <code class="language-plaintext highlighter-rouge">div</code> с <code class="language-plaintext highlighter-rouge">id</code> и <code class="language-plaintext highlighter-rouge">data</code>-атрибутом. Делаем <code class="language-plaintext highlighter-rouge">placeholder</code> по значению <code class="language-plaintext highlighter-rouge">data</code>-атрибута. На фокусе очищаем содержимое элемента, если оно совпадает с текстом <code class="language-plaintext highlighter-rouge">placeholder</code>‘а. На <code class="language-plaintext highlighter-rouge">blur</code>‘е, если пользователь ничего не ввёл, возвращаем <code class="language-plaintext highlighter-rouge">placeholder</code>.</p>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">const</span> <span class="nx">el</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">edit-me</span><span class="dl">'</span><span class="p">);</span>
<span class="kd">const</span> <span class="nx">placeholder</span> <span class="o">=</span> <span class="nx">el</span><span class="p">.</span><span class="nx">getAttribute</span><span class="p">(</span><span class="dl">'</span><span class="s1">data-placeholder</span><span class="dl">'</span><span class="p">);</span>

<span class="cm">/* Если элемент пустой, заполняем его строкой
из `data`-атрибута */</span>
<span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">===</span> <span class="dl">''</span> <span class="o">&amp;&amp;</span> <span class="p">(</span><span class="nx">el</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">placeholder</span><span class="p">);</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">focus</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err">  </span><span class="cm">/* Альтернатива выражению `if`: если `value`
  равно `placeholder`, тогда очищаем элемент */</span>
<span class="err">  </span><span class="nx">value</span> <span class="o">===</span> <span class="nx">placeholder</span> <span class="o">&amp;&amp;</span>
<span class="err">    </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">''</span><span class="p">);</span>
<span class="p">});</span>

<span class="nx">el</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">blur</span><span class="dl">'</span><span class="p">,</span> <span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">value</span> <span class="o">=</span> <span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span><span class="p">;</span>
<span class="err">  </span><span class="nx">value</span> <span class="o">===</span> <span class="dl">''</span> <span class="o">&amp;&amp;</span>
<span class="err">    </span><span class="p">(</span><span class="nx">e</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="nx">placeholder</span><span class="p">);</span>
<span class="p">});</span>
</code></pre></div>      </div>
    </div>
</details>
<details class="accordion">
  <summary class="accordion__header">
    Скопировать пример кода со страницы
  </summary>
  <div class="accordion__body">
      <p>Задача. Предоставить пользователю скопировать в буфер обмена пример кода по нажатию кнопки.</p>

      <div class="language-html highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nt">&lt;pre</span> <span class="na">id=</span><span class="s">"sample-code"</span><span class="nt">&gt;&lt;code&gt;</span>...<span class="nt">&lt;/code&gt;&lt;/pre&gt;</span>
<span class="nt">&lt;button</span> <span class="na">id=</span><span class="s">"copy-button"</span><span class="nt">&gt;</span>Copy<span class="nt">&lt;/button&gt;</span>
</code></pre></div>      </div>

      <p>Копирование выполняется в три этапа:</p>

      <ul>
        <li>Выделяем содержимое тега <code class="language-plaintext highlighter-rouge">&lt;code&gt;</code>.</li>
        <li>Копируем в буфер, используя метод <code class="language-plaintext highlighter-rouge">document.execCommand('copy')</code>
☝️🧐 Метод <code class="language-plaintext highlighter-rouge">execCommand()</code> официально считается устаревшим, но альтернативы пока нет. Если нужны команды для работы с контентом в режиме редактирования документа — <code class="language-plaintext highlighter-rouge">document.designMode</code> — пока приходится пользоваться <code class="language-plaintext highlighter-rouge">execCommand()</code> */</li>
        <li>Предыдущие шаги связаны с изменением пользовательского выделения. Поэтому исходное выделение надо сохранить и восстановить после копирования.</li>
      </ul>

      <div class="language-js highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">copyButton</span> <span class="o">=</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy-button</span><span class="dl">'</span><span class="p">);</span>
<span class="err">  </span><span class="kd">const</span> <span class="nx">codeEle</span> <span class="o">=</span>
<span class="err">    </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">sample-code</span><span class="dl">'</span><span class="p">);</span>

<span class="err">  </span><span class="nx">copyButton</span><span class="p">.</span><span class="nx">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">click</span><span class="dl">'</span><span class="p">,</span> <span class="p">()</span> <span class="o">=&gt;</span> <span class="p">{</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">selection</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">getSelection</span><span class="p">();</span>

<span class="err">    </span><span class="c1">// Сохраняем выделение</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">currentRange</span> <span class="o">=</span>
<span class="err">      </span><span class="nx">selection</span><span class="p">.</span><span class="nx">rangeCount</span> <span class="o">===</span> <span class="mi">0</span>
<span class="err">        </span><span class="p">?</span> <span class="kc">null</span>
<span class="err">        </span><span class="p">:</span> <span class="nx">selection</span><span class="p">.</span><span class="nx">getRangeAt</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>

<span class="err">    </span><span class="c1">// Выделяем содержимое между `&lt;code&gt;`</span>
<span class="err">    </span><span class="kd">const</span> <span class="nx">range</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">createRange</span><span class="p">();</span>
<span class="err">    </span><span class="nx">range</span><span class="p">.</span><span class="nx">selectNodeContents</span><span class="p">(</span><span class="nx">codeEle</span><span class="p">);</span>
<span class="err">    </span><span class="nx">selection</span><span class="p">.</span><span class="nx">removeAllRanges</span><span class="p">();</span>
<span class="err">    </span><span class="nx">selection</span><span class="p">.</span><span class="nx">addRange</span><span class="p">(</span><span class="nx">range</span><span class="p">);</span>

<span class="err">    </span><span class="c1">// Копируем в буфер</span>
<span class="err">    </span><span class="k">try</span> <span class="p">{</span>
<span class="err">      </span><span class="nb">document</span><span class="p">.</span><span class="nx">execCommand</span><span class="p">(</span><span class="dl">'</span><span class="s1">copy</span><span class="dl">'</span><span class="p">);</span>
<span class="err">      </span><span class="nx">copyButton</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Copied</span><span class="dl">'</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="nx">err</span><span class="p">)</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// Невозможно скопировать</span>
<span class="err">      </span><span class="nx">copyButton</span><span class="p">.</span><span class="nx">innerHTML</span> <span class="o">=</span> <span class="dl">'</span><span class="s1">Copy</span><span class="dl">'</span><span class="p">;</span>
<span class="err">    </span><span class="p">}</span> <span class="k">finally</span> <span class="p">{</span>
<span class="err">      </span><span class="c1">// Восстанавливаем выделение</span>
<span class="err">      </span><span class="nx">selection</span><span class="p">.</span><span class="nx">removeAllRanges</span><span class="p">();</span>
<span class="err">      </span><span class="nx">currentRange</span> <span class="o">&amp;&amp;</span>
<span class="err">      </span><span class="nx">selection</span><span class="p">.</span><span class="nx">addRange</span><span class="p">(</span><span class="nx">currentRange</span><span class="p">);</span>
<span class="err">    </span><span class="p">}</span>
<span class="err">  </span><span class="p">});</span>
<span class="p">})();</span>
</code></pre></div>      </div>
    </div>
</details>
</section>

<p>См. также <a href="/">шпаргалку</a> и <a href="/js/advanced-theory.html">материалы для углубленного изучения</a>.</p>

</main><footer class="footer">
  <p class="footer__copyright">
    © 2022 Владимир Никишин,&nbsp;
    <a href="https://super-mark.ru/" target="_blank" rel="noopener noreferrer">
      SuperMark
    </a>.
  </p>
  <p class="footer__credits-caption">По материалам:</p>
  <ul class="footer__credits"><li><a href="https://htmldom.dev/" target="_blank" rel="noopener noreferrer">HTML DOM</a>.</li></ul>
</footer>
<script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.4.0/highlight.min.js"></script>
<script src="/assets/js/main.js?20221103-0742"></script>

<script>
  hljs.highlightAll();
</script>

  </body>
</html>
